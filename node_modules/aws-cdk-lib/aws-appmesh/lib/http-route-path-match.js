"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.HttpGatewayRoutePathMatch = exports.HttpRoutePathMatch = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 * Defines HTTP route matching based on the URL path of the request.
 *
 * @stability stable
 */
class HttpRoutePathMatch {
    /**
     * The value of the path must match the specified value exactly.
     *
     * The provided `path` must start with the '/' character.
     *
     * @param path the exact path to match on.
     * @stability stable
     */
    static exactly(path) {
        return new HttpRouteWholePathMatch({ exact: path });
    }
    /**
     * The value of the path must match the specified regex.
     *
     * @param regex the regex used to match the path.
     * @stability stable
     */
    static regex(regex) {
        return new HttpRouteWholePathMatch({ regex: regex });
    }
    /**
     * The value of the path must match the specified prefix.
     *
     * @param prefix the value to use to match the beginning of the path part of the URL of the request.
     * @stability stable
     */
    static startsWith(prefix) {
        return new HttpRoutePrefixPathMatch(prefix);
    }
}
exports.HttpRoutePathMatch = HttpRoutePathMatch;
_a = JSII_RTTI_SYMBOL_1;
HttpRoutePathMatch[_a] = { fqn: "aws-cdk-lib.aws_appmesh.HttpRoutePathMatch", version: "2.0.0" };
class HttpRoutePrefixPathMatch extends HttpRoutePathMatch {
    constructor(prefix) {
        super();
        this.prefix = prefix;
        if (prefix && prefix[0] !== '/') {
            throw new Error(`Prefix Path for the match must start with \'/\', got: ${prefix}`);
        }
    }
    bind(_scope) {
        return {
            prefixPathMatch: this.prefix,
        };
    }
}
class HttpRouteWholePathMatch extends HttpRoutePathMatch {
    constructor(match) {
        super();
        this.match = match;
        if (match.exact && match.exact[0] !== '/') {
            throw new Error(`Exact Path for the match must start with \'/\', got: ${match.exact}`);
        }
    }
    bind(_scope) {
        return {
            wholePathMatch: this.match,
        };
    }
}
/**
 * Defines HTTP gateway route matching based on the URL path of the request.
 *
 * @stability stable
 */
class HttpGatewayRoutePathMatch {
    /**
     * The value of the path must match the specified prefix.
     *
     * @param prefix the value to use to match the beginning of the path part of the URL of the request.
     * @param rewriteTo Specify either disabling automatic rewrite or rewriting to specified prefix path.
     * @stability stable
     */
    static startsWith(prefix, rewriteTo) {
        return new HttpGatewayRoutePrefixPathMatch(prefix, rewriteTo);
    }
    /**
     * The value of the path must match the specified value exactly.
     *
     * The provided `path` must start with the '/' character.
     *
     * @param path the exact path to match on.
     * @param rewriteTo the value to substitute for the matched part of the path of the gateway request URL As a default, retains original request's URL path.
     * @stability stable
     */
    static exactly(path, rewriteTo) {
        return new HttpGatewayRouteWholePathMatch({ exact: path }, rewriteTo);
    }
    /**
     * The value of the path must match the specified regex.
     *
     * @param regex the regex used to match the path.
     * @param rewriteTo the value to substitute for the matched part of the path of the gateway request URL As a default, retains original request's URL path.
     * @stability stable
     */
    static regex(regex, rewriteTo) {
        return new HttpGatewayRouteWholePathMatch({ regex }, rewriteTo);
    }
}
exports.HttpGatewayRoutePathMatch = HttpGatewayRoutePathMatch;
_b = JSII_RTTI_SYMBOL_1;
HttpGatewayRoutePathMatch[_b] = { fqn: "aws-cdk-lib.aws_appmesh.HttpGatewayRoutePathMatch", version: "2.0.0" };
class HttpGatewayRoutePrefixPathMatch extends HttpGatewayRoutePathMatch {
    constructor(prefixPathMatch, rewriteTo) {
        super();
        this.prefixPathMatch = prefixPathMatch;
        this.rewriteTo = rewriteTo;
        if (prefixPathMatch[0] !== '/') {
            throw new Error('Prefix path for the match must start with \'/\', '
                + `got: ${prefixPathMatch}`);
        }
        if (rewriteTo) {
            if (prefixPathMatch[prefixPathMatch.length - 1] !== '/') {
                throw new Error('When prefix path for the rewrite is specified, prefix path for the match must end with \'/\', '
                    + `got: ${prefixPathMatch}`);
            }
            if (rewriteTo[0] !== '/' || rewriteTo[rewriteTo.length - 1] !== '/') {
                throw new Error('Prefix path for the rewrite must start and end with \'/\', '
                    + `got: ${rewriteTo}`);
            }
        }
    }
    bind(_scope) {
        return {
            prefixPathMatch: this.prefixPathMatch,
            prefixPathRewrite: this.rewriteTo === undefined
                ? undefined
                : {
                    defaultPrefix: this.rewriteTo === '' ? 'DISABLED' : undefined,
                    value: this.rewriteTo === '' ? undefined : this.rewriteTo,
                },
        };
    }
}
class HttpGatewayRouteWholePathMatch extends HttpGatewayRoutePathMatch {
    constructor(wholePathMatch, exactPathRewrite) {
        super();
        this.wholePathMatch = wholePathMatch;
        this.exactPathRewrite = exactPathRewrite;
        if (wholePathMatch.exact && wholePathMatch.exact[0] !== '/') {
            throw new Error(`Exact Path for the match must start with \'/\', got: ${wholePathMatch.exact}`);
        }
        if (exactPathRewrite === '') {
            throw new Error('Exact Path for the rewrite cannot be empty. Unlike startsWith() method, no automatic rewrite on whole path match');
        }
        if (exactPathRewrite && exactPathRewrite[0] !== '/') {
            throw new Error(`Exact Path for the rewrite must start with \'/\', got: ${exactPathRewrite}`);
        }
    }
    bind(_scope) {
        return {
            wholePathMatch: this.wholePathMatch,
            wholePathRewrite: this.exactPathRewrite === undefined ? undefined : { exact: this.exactPathRewrite },
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC1yb3V0ZS1wYXRoLW1hdGNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaHR0cC1yb3V0ZS1wYXRoLW1hdGNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFhQSxNQUFzQixrQkFBa0I7Ozs7Ozs7OztJQUUvQixNQUFNLENBQUMsT0FBTyxDQUFDLElBQVk7UUFDaEMsT0FBTyxJQUFJLHVCQUF1QixDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7S0FDckQ7Ozs7Ozs7SUFHTSxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQWE7UUFDL0IsT0FBTyxJQUFJLHVCQUF1QixDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7S0FDdEQ7Ozs7Ozs7SUFHTSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQWM7UUFDckMsT0FBTyxJQUFJLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzdDOztBQWRILGdEQWtCQzs7O0FBRUQsTUFBTSx3QkFBeUIsU0FBUSxrQkFBa0I7SUFDdkQsWUFBNkIsTUFBYztRQUN6QyxLQUFLLEVBQUUsQ0FBQztRQURtQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBR3pDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUU7WUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyx5REFBeUQsTUFBTSxFQUFFLENBQUMsQ0FBQztTQUNwRjtLQUNGO0lBRUQsSUFBSSxDQUFDLE1BQWlCO1FBQ3BCLE9BQU87WUFDTCxlQUFlLEVBQUUsSUFBSSxDQUFDLE1BQU07U0FDN0IsQ0FBQztLQUNIO0NBQ0Y7QUFFRCxNQUFNLHVCQUF3QixTQUFRLGtCQUFrQjtJQUN0RCxZQUE2QixLQUFxQztRQUNoRSxLQUFLLEVBQUUsQ0FBQztRQURtQixVQUFLLEdBQUwsS0FBSyxDQUFnQztRQUdoRSxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLEtB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QUNELElBQUksZ0JBQWdCLEtBQUssRUFBRSxFQUFFO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0hBQWtILENBQUMsQ0FBQztTQUNySTtRQUNELElBQUksZ0JBQWdCLElBQUksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO1lBQ25ELE1BQU0sSUFBSSxLQUFLLENBQUMsMERBQTJELGdCQUFpQixFQUFFLENBQUMsQ0FBQztTQUNqRztLQUNGO0lBRUQsSUFBSSxDQUFDLE1BQWlCO1FBQ3BCLE9BQU87WUFDTCxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7WUFDbkMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7U0FDckcsQ0FBQztLQUNIO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IENmbkdhdGV3YXlSb3V0ZSwgQ2ZuUm91dGUgfSBmcm9tICcuL2FwcG1lc2guZ2VuZXJhdGVkJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgaW50ZXJmYWNlIEh0dHBSb3V0ZVBhdGhNYXRjaENvbmZpZyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHdob2xlUGF0aE1hdGNoPzogQ2ZuUm91dGUuSHR0cFBhdGhNYXRjaFByb3BlcnR5O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBwcmVmaXhQYXRoTWF0Y2g/OiBzdHJpbmc7XG59XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBIdHRwUm91dGVQYXRoTWF0Y2gge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICBwdWJsaWMgc3RhdGljIGV4YWN0bHkocGF0aDogc3RyaW5nKTogSHR0cFJvdXRlUGF0aE1hdGNoIHtcbiAgICByZXR1cm4gbmV3IEh0dHBSb3V0ZVdob2xlUGF0aE1hdGNoKHsgZXhhY3Q6IHBhdGggfSk7XG4gIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHB1YmxpYyBzdGF0aWMgcmVnZXgocmVnZXg6IHN0cmluZyk6IEh0dHBSb3V0ZVBhdGhNYXRjaCB7XG4gICAgcmV0dXJuIG5ldyBIdHRwUm91dGVXaG9sZVBhdGhNYXRjaCh7IHJlZ2V4OiByZWdleCB9KTtcbiAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIHN0YXRpYyBzdGFydHNXaXRoKHByZWZpeDogc3RyaW5nKTogSHR0cFJvdXRlUGF0aE1hdGNoIHtcbiAgICByZXR1cm4gbmV3IEh0dHBSb3V0ZVByZWZpeFBhdGhNYXRjaChwcmVmaXgpO1xuICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICBwdWJsaWMgYWJzdHJhY3QgYmluZChzY29wZTogQ29uc3RydWN0KTogSHR0cFJvdXRlUGF0aE1hdGNoQ29uZmlnO1xufVxuXG5jbGFzcyBIdHRwUm91dGVQcmVmaXhQYXRoTWF0Y2ggZXh0ZW5kcyBIdHRwUm91dGVQYXRoTWF0Y2gge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByZWZpeDogc3RyaW5nKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmIChwcmVmaXggJiYgcHJlZml4WzBdICE9PSAnLycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUHJlZml4IFBhdGggZm9yIHRoZSBtYXRjaCBtdXN0IHN0YXJ0IHdpdGggXFwnL1xcJywgZ290OiAke3ByZWZpeH1gKTtcbiAgICB9XG4gIH1cblxuICBiaW5kKF9zY29wZTogQ29uc3RydWN0KTogSHR0cFJvdXRlUGF0aE1hdGNoQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgcHJlZml4UGF0aE1hdGNoOiB0aGlzLnByZWZpeCxcbiAgICB9O1xuICB9XG59XG5cbmNsYXNzIEh0dHBSb3V0ZVdob2xlUGF0aE1hdGNoIGV4dGVuZHMgSHR0cFJvdXRlUGF0aE1hdGNoIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBtYXRjaDogQ2ZuUm91dGUuSHR0cFBhdGhNYXRjaFByb3BlcnR5KSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmIChtYXRjaC5leGFjdCAmJiBtYXRjaC5leGFjdFswXSAhPT0gJy8nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4YWN0IFBhdGggZm9yIHRoZSBtYXRjaCBtdXN0IHN0YXJ0IHdpdGggXFwnL1xcJywgZ290OiAke21hdGNoLmV4YWN0fWApO1xuICAgIH1cbiAgfVxuXG4gIGJpbmQoX3Njb3BlOiBDb25zdHJ1Y3QpOiBIdHRwUm91dGVQYXRoTWF0Y2hDb25maWcge1xuICAgIHJldHVybiB7XG4gICAgICB3aG9sZVBhdGhNYXRjaDogdGhpcy5tYXRjaCxcbiAgICB9O1xuICB9XG59XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbmV4cG9ydCBpbnRlcmZhY2UgSHR0cEdhdGV3YXlSb3V0ZVBhdGhNYXRjaENvbmZpZyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgd2hvbGVQYXRoTWF0Y2g/OiBDZm5HYXRld2F5Um91dGUuSHR0cFBhdGhNYXRjaFByb3BlcnR5O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHByZWZpeFBhdGhNYXRjaD86IHN0cmluZztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgd2hvbGVQYXRoUmV3cml0ZT86IENmbkdhdGV3YXlSb3V0ZS5IdHRwR2F0ZXdheVJvdXRlUGF0aFJld3JpdGVQcm9wZXJ0eTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgcHJlZml4UGF0aFJld3JpdGU/OiBDZm5HYXRld2F5Um91dGUuSHR0cEdhdGV3YXlSb3V0ZVByZWZpeFJld3JpdGVQcm9wZXJ0eTtcbn1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgSHR0cEdhdGV3YXlSb3V0ZVBhdGhNYXRjaCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIHN0YXRpYyBzdGFydHNXaXRoKHByZWZpeDogc3RyaW5nLCByZXdyaXRlVG8/OiBzdHJpbmcpOiBIdHRwR2F0ZXdheVJvdXRlUGF0aE1hdGNoIHtcbiAgICByZXR1cm4gbmV3IEh0dHBHYXRld2F5Um91dGVQcmVmaXhQYXRoTWF0Y2gocHJlZml4LCByZXdyaXRlVG8pO1xuICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICBwdWJsaWMgc3RhdGljIGV4YWN0bHkocGF0aDogc3RyaW5nLCByZXdyaXRlVG8/OiBzdHJpbmcpOiBIdHRwR2F0ZXdheVJvdXRlUGF0aE1hdGNoIHtcbiAgICByZXR1cm4gbmV3IEh0dHBHYXRld2F5Um91dGVXaG9sZVBhdGhNYXRjaCh7IGV4YWN0OiBwYXRoIH0sIHJld3JpdGVUbyk7XG4gIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIHN0YXRpYyByZWdleChyZWdleDogc3RyaW5nLCByZXdyaXRlVG8/OiBzdHJpbmcpOiBIdHRwR2F0ZXdheVJvdXRlUGF0aE1hdGNoIHtcbiAgICByZXR1cm4gbmV3IEh0dHBHYXRld2F5Um91dGVXaG9sZVBhdGhNYXRjaCh7IHJlZ2V4IH0sIHJld3JpdGVUbyk7XG4gIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIGFic3RyYWN0IGJpbmQoc2NvcGU6IENvbnN0cnVjdCk6IEh0dHBHYXRld2F5Um91dGVQYXRoTWF0Y2hDb25maWc7XG59XG5cbmNsYXNzIEh0dHBHYXRld2F5Um91dGVQcmVmaXhQYXRoTWF0Y2ggZXh0ZW5kcyBIdHRwR2F0ZXdheVJvdXRlUGF0aE1hdGNoIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmVmaXhQYXRoTWF0Y2g6IHN0cmluZyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJld3JpdGVUbz86IHN0cmluZyxcbiAgKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmIChwcmVmaXhQYXRoTWF0Y2hbMF0gIT09ICcvJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcmVmaXggcGF0aCBmb3IgdGhlIG1hdGNoIG11c3Qgc3RhcnQgd2l0aCBcXCcvXFwnLCAnXG4gICAgICAgICsgYGdvdDogJHtwcmVmaXhQYXRoTWF0Y2h9YCk7XG4gICAgfVxuXG4gICAgaWYgKHJld3JpdGVUbykge1xuICAgICAgaWYgKHByZWZpeFBhdGhNYXRjaFtwcmVmaXhQYXRoTWF0Y2gubGVuZ3RoIC0gMV0gIT09ICcvJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gcHJlZml4IHBhdGggZm9yIHRoZSByZXdyaXRlIGlzIHNwZWNpZmllZCwgcHJlZml4IHBhdGggZm9yIHRoZSBtYXRjaCBtdXN0IGVuZCB3aXRoIFxcJy9cXCcsICdcbiAgICAgICAgICArIGBnb3Q6ICR7cHJlZml4UGF0aE1hdGNofWApO1xuICAgICAgfVxuICAgICAgaWYgKHJld3JpdGVUb1swXSAhPT0gJy8nIHx8IHJld3JpdGVUb1tyZXdyaXRlVG8ubGVuZ3RoIC0gMV0gIT09ICcvJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByZWZpeCBwYXRoIGZvciB0aGUgcmV3cml0ZSBtdXN0IHN0YXJ0IGFuZCBlbmQgd2l0aCBcXCcvXFwnLCAnXG4gICAgICAgICAgKyBgZ290OiAke3Jld3JpdGVUb31gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBiaW5kKF9zY29wZTogQ29uc3RydWN0KTogSHR0cEdhdGV3YXlSb3V0ZVBhdGhNYXRjaENvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHByZWZpeFBhdGhNYXRjaDogdGhpcy5wcmVmaXhQYXRoTWF0Y2gsXG4gICAgICBwcmVmaXhQYXRoUmV3cml0ZTogdGhpcy5yZXdyaXRlVG8gPT09IHVuZGVmaW5lZFxuICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICA6IHtcbiAgICAgICAgICBkZWZhdWx0UHJlZml4OiB0aGlzLnJld3JpdGVUbyA9PT0gJycgPyAnRElTQUJMRUQnIDogdW5kZWZpbmVkLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLnJld3JpdGVUbyA9PT0gJycgPyB1bmRlZmluZWQgOiB0aGlzLnJld3JpdGVUbyxcbiAgICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbmNsYXNzIEh0dHBHYXRld2F5Um91dGVXaG9sZVBhdGhNYXRjaCBleHRlbmRzIEh0dHBHYXRld2F5Um91dGVQYXRoTWF0Y2gge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdob2xlUGF0aE1hdGNoOiBDZm5HYXRld2F5Um91dGUuSHR0cFBhdGhNYXRjaFByb3BlcnR5LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZXhhY3RQYXRoUmV3cml0ZT86IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmICh3aG9sZVBhdGhNYXRjaC5leGFjdCAmJiB3aG9sZVBhdGhNYXRjaC5leGFjdFswXSAhPT0gJy8nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4YWN0IFBhdGggZm9yIHRoZSBtYXRjaCBtdXN0IHN0YXJ0IHdpdGggXFwnL1xcJywgZ290OiAkeyB3aG9sZVBhdGhNYXRjaC5leGFjdCB9YCk7XG4gICAgfVxuICAgIGlmIChleGFjdFBhdGhSZXdyaXRlID09PSAnJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeGFjdCBQYXRoIGZvciB0aGUgcmV3cml0ZSBjYW5ub3QgYmUgZW1wdHkuIFVubGlrZSBzdGFydHNXaXRoKCkgbWV0aG9kLCBubyBhdXRvbWF0aWMgcmV3cml0ZSBvbiB3aG9sZSBwYXRoIG1hdGNoJyk7XG4gICAgfVxuICAgIGlmIChleGFjdFBhdGhSZXdyaXRlICYmIGV4YWN0UGF0aFJld3JpdGVbMF0gIT09ICcvJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeGFjdCBQYXRoIGZvciB0aGUgcmV3cml0ZSBtdXN0IHN0YXJ0IHdpdGggXFwnL1xcJywgZ290OiAkeyBleGFjdFBhdGhSZXdyaXRlIH1gKTtcbiAgICB9XG4gIH1cblxuICBiaW5kKF9zY29wZTogQ29uc3RydWN0KTogSHR0cEdhdGV3YXlSb3V0ZVBhdGhNYXRjaENvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdob2xlUGF0aE1hdGNoOiB0aGlzLndob2xlUGF0aE1hdGNoLFxuICAgICAgd2hvbGVQYXRoUmV3cml0ZTogdGhpcy5leGFjdFBhdGhSZXdyaXRlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiB7IGV4YWN0OiB0aGlzLmV4YWN0UGF0aFJld3JpdGUgfSxcbiAgICB9O1xuICB9XG59XG4iXX0=
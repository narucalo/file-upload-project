"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipeline = void 0;
const jsiiDeprecationWarnings = require("../../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const path = require("path");
const cb = require("../../../aws-codebuild");
const cp = require("../../../aws-codepipeline");
const cpa = require("../../../aws-codepipeline-actions");
const iam = require("../../../aws-iam");
const core_1 = require("../../../core");
const cxapi = require("../../../cx-api");
const blueprint_1 = require("../blueprint");
const docker_credentials_1 = require("../docker-credentials");
const helpers_internal_1 = require("../helpers-internal");
const main_1 = require("../main");
const asset_singleton_role_1 = require("../private/asset-singleton-role");
const construct_internals_1 = require("../private/construct-internals");
const fs_1 = require("../private/fs");
const javascript_1 = require("../private/javascript");
const template_configuration_1 = require("../private/template-configuration");
const _codebuild_factory_1 = require("./_codebuild-factory");
const artifact_map_1 = require("./artifact-map");
const codebuild_step_1 = require("./codebuild-step");
/**
 * A CDK Pipeline that uses CodePipeline to deploy CDK apps.
 *
 * This is a `Pipeline` with its `engine` property set to
 * `CodePipelineEngine`, and exists for nicer ergonomics for
 * users that don't need to switch out engines.
 *
 * @stability stable
 */
class CodePipeline extends main_1.PipelineBase {
    /**
     * @stability stable
     */
    constructor(scope, id, props) {
        var _b, _c, _d;
        super(scope, id, props);
        this.props = props;
        this.artifacts = new artifact_map_1.ArtifactMap();
        /**
         * Asset roles shared for publishing
         */
        this.assetCodeBuildRoles = {};
        /**
         * Per asset type, the target role ARNs that need to be assumed
         */
        this.assetPublishingRoles = {};
        jsiiDeprecationWarnings.aws_cdk_lib_pipelines_CodePipelineProps(props);
        this.selfMutation = (_b = props.selfMutation) !== null && _b !== void 0 ? _b : true;
        this.dockerCredentials = (_c = props.dockerCredentials) !== null && _c !== void 0 ? _c : [];
        this.singlePublisherPerAssetType = !((_d = props.publishAssetsInParallel) !== null && _d !== void 0 ? _d : true);
    }
    /**
     * The CodeBuild project that performs the Synth.
     *
     * Only available after the pipeline has been built.
     *
     * @stability stable
     */
    get synthProject() {
        if (!this._synthProject) {
            throw new Error('Call pipeline.buildPipeline() before reading this property');
        }
        return this._synthProject;
    }
    /**
     * The CodePipeline pipeline that deploys the CDK app.
     *
     * Only available after the pipeline has been built.
     *
     * @stability stable
     */
    get pipeline() {
        if (!this._pipeline) {
            throw new Error('Pipeline not created yet');
        }
        return this._pipeline;
    }
    /**
     * Implemented by subclasses to do the actual pipeline construction.
     *
     * @stability stable
     */
    doBuildPipeline() {
        var _b;
        if (this._pipeline) {
            throw new Error('Pipeline already created');
        }
        this._myCxAsmRoot = path.resolve(construct_internals_1.assemblyBuilderOf(construct_internals_1.appOf(this)).outdir);
        if (this.props.codePipeline) {
            if (this.props.pipelineName) {
                throw new Error('Cannot set \'pipelineName\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.crossAccountKeys !== undefined) {
                throw new Error('Cannot set \'crossAccountKeys\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            this._pipeline = this.props.codePipeline;
        }
        else {
            this._pipeline = new cp.Pipeline(this, 'Pipeline', {
                pipelineName: this.props.pipelineName,
                crossAccountKeys: (_b = this.props.crossAccountKeys) !== null && _b !== void 0 ? _b : false,
                // This is necessary to make self-mutation work (deployments are guaranteed
                // to happen only after the builds of the latest pipeline definition).
                restartExecutionOnUpdate: true,
            });
        }
        const graphFromBp = new helpers_internal_1.PipelineGraph(this, {
            selfMutation: this.selfMutation,
            singlePublisherPerAssetType: this.singlePublisherPerAssetType,
        });
        this._cloudAssemblyFileSet = graphFromBp.cloudAssemblyFileSet;
        this.pipelineStagesAndActionsFromGraph(graphFromBp);
    }
    get myCxAsmRoot() {
        if (!this._myCxAsmRoot) {
            throw new Error('Can\'t read \'myCxAsmRoot\' if build deployment not called yet');
        }
        return this._myCxAsmRoot;
    }
    /**
     * Scope for Assets-related resources.
     *
     * Purely exists for construct tree backwards compatibility with legacy pipelines
     */
    get assetsScope() {
        return construct_internals_1.obtainScope(this, 'Assets');
    }
    pipelineStagesAndActionsFromGraph(structure) {
        var _b;
        // Translate graph into Pipeline Stages and Actions
        let beforeSelfMutation = this.selfMutation;
        for (const stageNode of javascript_1.flatten(structure.graph.sortedChildren())) {
            if (!helpers_internal_1.isGraph(stageNode)) {
                throw new Error(`Top-level children must be graphs, got '${stageNode}'`);
            }
            // Group our ordered tranches into blocks of 50.
            // We can map these onto stages without exceeding the capacity of a Stage.
            const chunks = chunkTranches(50, stageNode.sortedLeaves());
            const actionsOverflowStage = chunks.length > 1;
            for (const [i, tranches] of javascript_1.enumerate(chunks)) {
                const stageName = actionsOverflowStage ? `${stageNode.id}.${i + 1}` : stageNode.id;
                const pipelineStage = this.pipeline.addStage({ stageName });
                const sharedParent = new helpers_internal_1.GraphNodeCollection(javascript_1.flatten(tranches)).commonAncestor();
                let runOrder = 1;
                for (const tranche of tranches) {
                    const runOrdersConsumed = [0];
                    for (const node of tranche) {
                        const factory = this.actionFromNode(node);
                        const nodeType = this.nodeTypeFromNode(node);
                        const result = factory.produceAction(pipelineStage, {
                            actionName: actionName(node, sharedParent),
                            runOrder,
                            artifacts: this.artifacts,
                            scope: construct_internals_1.obtainScope(this.pipeline, stageName),
                            fallbackArtifact: this._fallbackArtifact,
                            pipeline: this,
                            // If this step happens to produce a CodeBuild job, set the default options
                            codeBuildDefaults: nodeType ? this.codeBuildDefaultsFor(nodeType) : undefined,
                            beforeSelfMutation,
                        });
                        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'self-update') {
                            beforeSelfMutation = false;
                        }
                        this.postProcessNode(node, result);
                        runOrdersConsumed.push(result.runOrdersConsumed);
                    }
                    runOrder += Math.max(...runOrdersConsumed);
                }
            }
        }
    }
    /**
     * Do additional things after the action got added to the pipeline
     *
     * Some minor state manipulation of CodeBuild projects and pipeline
     * artifacts.
     */
    postProcessNode(node, result) {
        var _b, _c, _d;
        const nodeType = this.nodeTypeFromNode(node);
        if (result.project) {
            const dockerUsage = dockerUsageFromCodeBuild(nodeType !== null && nodeType !== void 0 ? nodeType : CodeBuildProjectType.STEP);
            if (dockerUsage) {
                for (const c of this.dockerCredentials) {
                    c.grantRead(result.project, dockerUsage);
                }
            }
            if (nodeType === CodeBuildProjectType.SYNTH) {
                this._synthProject = result.project;
            }
        }
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step' && ((_c = node.data.step.primaryOutput) === null || _c === void 0 ? void 0 : _c.primaryOutput) && !this._fallbackArtifact) {
            this._fallbackArtifact = this.artifacts.toCodePipeline((_d = node.data.step.primaryOutput) === null || _d === void 0 ? void 0 : _d.primaryOutput);
        }
    }
    /**
     * Make an action from the given node and/or step
     */
    actionFromNode(node) {
        var _b, _c;
        switch ((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) {
            // Nothing for these, they are groupings (shouldn't even have popped up here)
            case 'group':
            case 'stack-group':
            case undefined:
                throw new Error(`actionFromNode: did not expect to get group nodes: ${(_c = node.data) === null || _c === void 0 ? void 0 : _c.type}`);
            case 'self-update':
                return this.selfMutateAction();
            case 'publish-assets':
                return this.publishAssetsAction(node, node.data.assets);
            case 'prepare':
                return this.createChangeSetAction(node.data.stack);
            case 'execute':
                return this.executeChangeSetAction(node.data.stack, node.data.captureOutputs);
            case 'step':
                return this.actionFromStep(node, node.data.step);
        }
    }
    /**
     * Take a Step and turn it into a CodePipeline Action
     *
     * There are only 3 types of Steps we need to support:
     *
     * - Shell (generic)
     * - ManualApproval (generic)
     * - CodePipelineActionFactory (CodePipeline-specific)
     *
     * The rest is expressed in terms of these 3, or in terms of graph nodes
     * which are handled elsewhere.
     */
    actionFromStep(node, step) {
        const nodeType = this.nodeTypeFromNode(node);
        // CodePipeline-specific steps first -- this includes Sources
        if (isCodePipelineActionFactory(step)) {
            return step;
        }
        // Now built-in steps
        if (step instanceof blueprint_1.ShellStep || step instanceof codebuild_step_1.CodeBuildStep) {
            // The 'CdkBuildProject' will be the construct ID of the CodeBuild project, necessary for backwards compat
            let constructId = nodeType === CodeBuildProjectType.SYNTH
                ? 'CdkBuildProject'
                : step.id;
            return step instanceof codebuild_step_1.CodeBuildStep
                ? _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(constructId, step)
                : _codebuild_factory_1.CodeBuildFactory.fromShellStep(constructId, step);
        }
        if (step instanceof blueprint_1.ManualApprovalStep) {
            return {
                produceAction: (stage, options) => {
                    stage.addAction(new cpa.ManualApprovalAction({
                        actionName: options.actionName,
                        runOrder: options.runOrder,
                        additionalInformation: step.comment,
                    }));
                    return { runOrdersConsumed: 1 };
                },
            };
        }
        throw new Error(`Deployment step '${step}' is not supported for CodePipeline-backed pipelines`);
    }
    createChangeSetAction(stack) {
        const changeSetName = 'PipelineChange';
        const templateArtifact = this.artifacts.toCodePipeline(this._cloudAssemblyFileSet);
        const templateConfigurationPath = this.writeTemplateConfiguration(stack);
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        const relativeTemplatePath = path.relative(this.myCxAsmRoot, stack.absoluteTemplatePath);
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationCreateReplaceChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    templatePath: templateArtifact.atPath(fs_1.toPosixPath(relativeTemplatePath)),
                    adminPermissions: true,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    deploymentRole: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.executionRoleArn),
                    region: region,
                    templateConfiguration: templateConfigurationPath
                        ? templateArtifact.atPath(fs_1.toPosixPath(templateConfigurationPath))
                        : undefined,
                    cfnCapabilities: [core_1.CfnCapabilities.NAMED_IAM, core_1.CfnCapabilities.AUTO_EXPAND],
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    executeChangeSetAction(stack, captureOutputs) {
        const changeSetName = 'PipelineChange';
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationExecuteChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    region: region,
                    variablesNamespace: captureOutputs ? _codebuild_factory_1.stackVariableNamespace(stack) : undefined,
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    selfMutateAction() {
        var _b;
        const installSuffix = this.props.cliVersion ? `@${this.props.cliVersion}` : '';
        const pipelineStack = core_1.Stack.of(this.pipeline);
        const pipelineStackIdentifier = (_b = pipelineStack.node.path) !== null && _b !== void 0 ? _b : pipelineStack.stackName;
        const step = new codebuild_step_1.CodeBuildStep('SelfMutate', {
            projectName: javascript_1.maybeSuffix(this.props.pipelineName, '-selfupdate'),
            input: this._cloudAssemblyFileSet,
            installCommands: [
                `npm install -g aws-cdk${installSuffix}`,
            ],
            commands: [
                `cdk -a ${fs_1.toPosixPath(construct_internals_1.embeddedAsmPath(this.pipeline))} deploy ${pipelineStackIdentifier} --require-approval=never --verbose`,
            ],
            rolePolicyStatements: [
                // allow the self-mutating project permissions to assume the bootstrap Action role
                new iam.PolicyStatement({
                    actions: ['sts:AssumeRole'],
                    resources: [`arn:*:iam::${core_1.Stack.of(this.pipeline).account}:role/*`],
                    conditions: {
                        'ForAnyValue:StringEquals': {
                            'iam:ResourceTag/aws-cdk:bootstrap-role': ['image-publishing', 'file-publishing', 'deploy'],
                        },
                    },
                }),
                new iam.PolicyStatement({
                    actions: ['cloudformation:DescribeStacks'],
                    resources: ['*'],
                }),
                // S3 checks for the presence of the ListBucket permission
                new iam.PolicyStatement({
                    actions: ['s3:ListBucket'],
                    resources: ['*'],
                }),
            ],
        });
        // Different on purpose -- id needed for backwards compatible LogicalID
        return _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep('SelfMutation', step, {
            additionalConstructLevel: false,
            scope: construct_internals_1.obtainScope(this, 'UpdatePipeline'),
        });
    }
    publishAssetsAction(node, assets) {
        var _b;
        const installSuffix = this.props.cliVersion ? `@${this.props.cliVersion}` : '';
        const commands = assets.map(asset => {
            const relativeAssetManifestPath = path.relative(this.myCxAsmRoot, asset.assetManifestPath);
            return `cdk-assets --path "${fs_1.toPosixPath(relativeAssetManifestPath)}" --verbose publish "${asset.assetSelector}"`;
        });
        const assetType = assets[0].assetType;
        if (assets.some(a => a.assetType !== assetType)) {
            throw new Error('All assets in a single publishing step must be of the same type');
        }
        const publishingRoles = this.assetPublishingRoles[assetType] = ((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : new Set());
        for (const asset of assets) {
            if (asset.assetPublishingRoleArn) {
                publishingRoles.add(asset.assetPublishingRoleArn);
            }
        }
        const role = this.obtainAssetCodeBuildRole(assets[0].assetType);
        // The base commands that need to be run
        const script = new codebuild_step_1.CodeBuildStep(node.id, {
            commands,
            installCommands: [
                `npm install -g cdk-assets${installSuffix}`,
            ],
            input: this._cloudAssemblyFileSet,
            buildEnvironment: {
                privileged: assets.some(asset => asset.assetType === blueprint_1.AssetType.DOCKER_IMAGE),
            },
            role,
        });
        // Customizations that are not accessible to regular users
        return _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(node.id, script, {
            additionalConstructLevel: false,
            // If we use a single publisher, pass buildspec via file otherwise it'll
            // grow too big.
            passBuildSpecViaCloudAssembly: this.singlePublisherPerAssetType,
            scope: this.assetsScope,
        });
    }
    nodeTypeFromNode(node) {
        var _b, _c, _d, _e;
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step') {
            return !!((_c = node.data) === null || _c === void 0 ? void 0 : _c.isBuildStep) ? CodeBuildProjectType.SYNTH : CodeBuildProjectType.STEP;
        }
        if (((_d = node.data) === null || _d === void 0 ? void 0 : _d.type) === 'publish-assets') {
            return CodeBuildProjectType.ASSETS;
        }
        if (((_e = node.data) === null || _e === void 0 ? void 0 : _e.type) === 'self-update') {
            return CodeBuildProjectType.SELF_MUTATE;
        }
        return undefined;
    }
    codeBuildDefaultsFor(nodeType) {
        const defaultOptions = {
            buildEnvironment: {
                buildImage: cb.LinuxBuildImage.STANDARD_5_0,
                computeType: cb.ComputeType.SMALL,
            },
        };
        const typeBasedCustomizations = {
            [CodeBuildProjectType.SYNTH]: this.props.dockerEnabledForSynth
                ? _codebuild_factory_1.mergeCodeBuildOptions(this.props.synthCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.synthCodeBuildDefaults,
            [CodeBuildProjectType.ASSETS]: this.props.assetPublishingCodeBuildDefaults,
            [CodeBuildProjectType.SELF_MUTATE]: this.props.dockerEnabledForSelfMutation
                ? _codebuild_factory_1.mergeCodeBuildOptions(this.props.selfMutationCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.selfMutationCodeBuildDefaults,
            [CodeBuildProjectType.STEP]: {},
        };
        const dockerUsage = dockerUsageFromCodeBuild(nodeType);
        const dockerCommands = dockerUsage !== undefined
            ? docker_credentials_1.dockerCredentialsInstallCommands(dockerUsage, this.dockerCredentials, 'both')
            : [];
        const typeBasedDockerCommands = dockerCommands.length > 0 ? {
            partialBuildSpec: cb.BuildSpec.fromObject({
                version: '0.2',
                phases: {
                    pre_build: {
                        commands: dockerCommands,
                    },
                },
            }),
        } : {};
        return _codebuild_factory_1.mergeCodeBuildOptions(defaultOptions, this.props.codeBuildDefaults, typeBasedCustomizations[nodeType], typeBasedDockerCommands);
    }
    roleFromPlaceholderArn(scope, region, account, arn) {
        if (!arn) {
            return undefined;
        }
        // Use placeholder arn as construct ID.
        const id = arn;
        // https://github.com/aws/aws-cdk/issues/7255
        let existingRole = scope.node.tryFindChild(`ImmutableRole${id}`);
        if (existingRole) {
            return existingRole;
        }
        // For when #7255 is fixed.
        existingRole = scope.node.tryFindChild(id);
        if (existingRole) {
            return existingRole;
        }
        const arnToImport = cxapi.EnvironmentPlaceholders.replace(arn, {
            region: region !== null && region !== void 0 ? region : core_1.Aws.REGION,
            accountId: account !== null && account !== void 0 ? account : core_1.Aws.ACCOUNT_ID,
            partition: core_1.Aws.PARTITION,
        });
        return iam.Role.fromRoleArn(scope, id, arnToImport, { mutable: false, addGrantsToResources: true });
    }
    /**
     * Non-template config files for CodePipeline actions
     *
     * Currently only supports tags.
     */
    writeTemplateConfiguration(stack) {
        if (Object.keys(stack.tags).length === 0) {
            return undefined;
        }
        const absConfigPath = `${stack.absoluteTemplatePath}.config.json`;
        const relativeConfigPath = path.relative(this.myCxAsmRoot, absConfigPath);
        // Write the template configuration file (for parameters into CreateChangeSet call that
        // cannot be configured any other way). They must come from a file, and there's unfortunately
        // no better hook to write this file (`construct.onSynthesize()` would have been the prime candidate
        // but that is being deprecated--and DeployCdkStackAction isn't even a construct).
        template_configuration_1.writeTemplateConfiguration(absConfigPath, {
            Tags: javascript_1.noUndefined(stack.tags),
        });
        return relativeConfigPath;
    }
    /**
     * This role is used by both the CodePipeline build action and related CodeBuild project. Consolidating these two
     * roles into one, and re-using across all assets, saves significant size of the final synthesized output.
     * Modeled after the CodePipeline role and 'CodePipelineActionRole' roles.
     * Generates one role per asset type to separate file and Docker/image-based permissions.
     */
    obtainAssetCodeBuildRole(assetType) {
        if (this.assetCodeBuildRoles[assetType]) {
            return this.assetCodeBuildRoles[assetType];
        }
        const stack = core_1.Stack.of(this);
        const rolePrefix = assetType === blueprint_1.AssetType.DOCKER_IMAGE ? 'Docker' : 'File';
        const assetRole = new asset_singleton_role_1.AssetSingletonRole(this.assetsScope, `${rolePrefix}Role`, {
            roleName: core_1.PhysicalName.GENERATE_IF_NEEDED,
            assumedBy: new iam.CompositePrincipal(new iam.ServicePrincipal('codebuild.amazonaws.com'), new iam.AccountPrincipal(stack.account)),
        });
        // Publishing role access
        // The ARNs include raw AWS pseudo parameters (e.g., ${AWS::Partition}), which need to be substituted.
        // Lazy-evaluated so all asset publishing roles are included.
        assetRole.addToPolicy(new iam.PolicyStatement({
            actions: ['sts:AssumeRole'],
            resources: core_1.Lazy.list({ produce: () => { var _b; return Array.from((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : []).map(arn => core_1.Fn.sub(arn)); } }),
        }));
        // Grant pull access for any ECR registries and secrets that exist
        if (assetType === blueprint_1.AssetType.DOCKER_IMAGE) {
            this.dockerCredentials.forEach(reg => reg.grantRead(assetRole, docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING));
        }
        this.assetCodeBuildRoles[assetType] = assetRole;
        return assetRole;
    }
}
exports.CodePipeline = CodePipeline;
_a = JSII_RTTI_SYMBOL_1;
CodePipeline[_a] = { fqn: "aws-cdk-lib.pipelines.CodePipeline", version: "2.0.0" };
function dockerUsageFromCodeBuild(cbt) {
    switch (cbt) {
        case CodeBuildProjectType.ASSETS: return docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING;
        case CodeBuildProjectType.SELF_MUTATE: return docker_credentials_1.DockerCredentialUsage.SELF_UPDATE;
        case CodeBuildProjectType.SYNTH: return docker_credentials_1.DockerCredentialUsage.SYNTH;
        case CodeBuildProjectType.STEP: return undefined;
    }
}
var CodeBuildProjectType;
(function (CodeBuildProjectType) {
    CodeBuildProjectType["SYNTH"] = "SYNTH";
    CodeBuildProjectType["ASSETS"] = "ASSETS";
    CodeBuildProjectType["SELF_MUTATE"] = "SELF_MUTATE";
    CodeBuildProjectType["STEP"] = "STEP";
})(CodeBuildProjectType || (CodeBuildProjectType = {}));
function actionName(node, parent) {
    const names = node.ancestorPath(parent).map(n => n.id);
    return names.map(sanitizeName).join('.').substr(0, 100); // Cannot exceed 100 chars
}
function sanitizeName(x) {
    return x.replace(/[^A-Za-z0-9.@\-_]/g, '_');
}
/**
 * Take a set of tranches and split them up into groups so
 * that no set of tranches has more than n items total
 */
function chunkTranches(n, xss) {
    const ret = [];
    while (xss.length > 0) {
        const tranches = [];
        let count = 0;
        while (xss.length > 0) {
            const xs = xss[0];
            const spaceRemaining = n - count;
            if (xs.length <= spaceRemaining) {
                tranches.push(xs);
                count += xs.length;
                xss.shift();
            }
            else {
                tranches.push(xs.splice(0, spaceRemaining));
                count = n;
                break;
            }
        }
        ret.push(tranches);
    }
    return ret;
}
function isCodePipelineActionFactory(x) {
    return !!x.produceAction;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29kZXBpcGVsaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUE2QjtBQUM3Qiw2Q0FBNkM7QUFDN0MsZ0RBQWdEO0FBQ2hELHlEQUF5RDtBQUV6RCx3Q0FBd0M7QUFDeEMsd0NBQW9GO0FBQ3BGLHlDQUF5QztBQUV6Qyw0Q0FBc0k7QUFDdEksOERBQWtIO0FBQ2xILDBEQUF5RztBQUN6RyxrQ0FBdUM7QUFDdkMsMEVBQXFFO0FBQ3JFLHdFQUF3RztBQUN4RyxzQ0FBNEM7QUFDNUMsc0RBQXFGO0FBQ3JGLDhFQUErRTtBQUMvRSw2REFBdUc7QUFDdkcsaURBQTZDO0FBQzdDLHFEQUFpRDs7Ozs7Ozs7OztBQXdFakQsTUFBYSxZQUFhLFNBQVEsbUJBQVk7Ozs7SUEyQjVDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQW1CLEtBQXdCOztRQUNqRixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQURpQyxVQUFLLEdBQUwsS0FBSyxDQUFtQjtRQXpCM0UsY0FBUyxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO1FBTXRDOztXQUVHO1FBQ2Msd0JBQW1CLEdBQThCLEVBQUUsQ0FBQztRQUVyRTs7V0FFRztRQUNjLHlCQUFvQixHQUFnQyxFQUFFLENBQUM7O1FBY3RFLElBQUksQ0FBQyxZQUFZLFNBQUcsS0FBSyxDQUFDLFlBQVksbUNBQUksSUFBSSxDQUFDO1FBQy9DLElBQUksQ0FBQyxpQkFBaUIsU0FBRyxLQUFLLENBQUMsaUJBQWlCLG1DQUFJLEVBQUUsQ0FBQztRQUN2RCxJQUFJLENBQUMsMkJBQTJCLEdBQUcsQ0FBQyxPQUFDLEtBQUssQ0FBQyx1QkFBdUIsbUNBQUksSUFBSSxDQUFDLENBQUM7S0FDN0U7Ozs7Ozs7O0lBR0QsSUFBVyxZQUFZO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3ZC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QUUsR0FBRyxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQUVEOzs7R0FHRztBQUNILFNBQVMsYUFBYSxDQUFJLENBQVMsRUFBRSxHQUFVO0lBQzdDLE1BQU0sR0FBRyxHQUFZLEVBQUUsQ0FBQztJQUV4QixPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sUUFBUSxHQUFVLEVBQUUsQ0FBQztRQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFFZCxPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixNQUFNLGNBQWMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQ2pDLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBSSxjQUFjLEVBQUU7Z0JBQy9CLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2xCLEtBQUssSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDO2dCQUNuQixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDYjtpQkFBTTtnQkFDTCxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLEtBQUssR0FBRyxDQUFDLENBQUM7Z0JBQ1YsTUFBTTthQUNQO1NBQ0Y7UUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ3BCO0lBR0QsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDO0FBRUQsU0FBUywyQkFBMkIsQ0FBQyxDQUFNO0lBQ3pDLE9BQU8sQ0FBQyxDQUFFLENBQWdDLENBQUMsYUFBYSxDQUFDO0FBQzNELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgY2IgZnJvbSAnLi4vLi4vLi4vYXdzLWNvZGVidWlsZCc7XG5pbXBvcnQgKiBhcyBjcCBmcm9tICcuLi8uLi8uLi9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGNwYSBmcm9tICcuLi8uLi8uLi9hd3MtY29kZXBpcGVsaW5lLWFjdGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJy4uLy4uLy4uL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJy4uLy4uLy4uL2F3cy1pYW0nO1xuaW1wb3J0IHsgQXdzLCBDZm5DYXBhYmlsaXRpZXMsIEZuLCBMYXp5LCBQaHlzaWNhbE5hbWUsIFN0YWNrIH0gZnJvbSAnLi4vLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICcuLi8uLi8uLi9jeC1hcGknO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBBc3NldFR5cGUsIEZpbGVTZXQsIElGaWxlU2V0UHJvZHVjZXIsIE1hbnVhbEFwcHJvdmFsU3RlcCwgU2hlbGxTdGVwLCBTdGFja0Fzc2V0LCBTdGFja0RlcGxveW1lbnQsIFN0ZXAgfSBmcm9tICcuLi9ibHVlcHJpbnQnO1xuaW1wb3J0IHsgRG9ja2VyQ3JlZGVudGlhbCwgZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMsIERvY2tlckNyZWRlbnRpYWxVc2FnZSB9IGZyb20gJy4uL2RvY2tlci1jcmVkZW50aWFscyc7XG5pbXBvcnQgeyBHcmFwaE5vZGUsIEdyYXBoTm9kZUNvbGxlY3Rpb24sIGlzR3JhcGgsIEFHcmFwaE5vZGUsIFBpcGVsaW5lR3JhcGggfSBmcm9tICcuLi9oZWxwZXJzLWludGVybmFsJztcbmltcG9ydCB7IFBpcGVsaW5lQmFzZSB9IGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgQXNzZXRTaW5nbGV0b25Sb2xlIH0gZnJvbSAnLi4vcHJpdmF0ZS9hc3NldC1zaW5nbGV0b24tcm9sZSc7XG5pbXBvcnQgeyBhcHBPZiwgYXNzZW1ibHlCdWlsZGVyT2YsIGVtYmVkZGVkQXNtUGF0aCwgb2J0YWluU2NvcGUgfSBmcm9tICcuLi9wcml2YXRlL2NvbnN0cnVjdC1pbnRlcm5hbHMnO1xuaW1wb3J0IHsgdG9Qb3NpeFBhdGggfSBmcm9tICcuLi9wcml2YXRlL2ZzJztcbmltcG9ydCB7IGVudW1lcmF0ZSwgZmxhdHRlbiwgbWF5YmVTdWZmaXgsIG5vVW5kZWZpbmVkIH0gZnJvbSAnLi4vcHJpdmF0ZS9qYXZhc2NyaXB0JztcbmltcG9ydCB7IHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vcHJpdmF0ZS90ZW1wbGF0ZS1jb25maWd1cmF0aW9uJztcbmltcG9ydCB7IENvZGVCdWlsZEZhY3RvcnksIG1lcmdlQ29kZUJ1aWxkT3B0aW9ucywgc3RhY2tWYXJpYWJsZU5hbWVzcGFjZSB9IGZyb20gJy4vX2NvZGVidWlsZC1mYWN0b3J5JztcbmltcG9ydCB7IEFydGlmYWN0TWFwIH0gZnJvbSAnLi9hcnRpZmFjdC1tYXAnO1xuaW1wb3J0IHsgQ29kZUJ1aWxkU3RlcCB9IGZyb20gJy4vY29kZWJ1aWxkLXN0ZXAnO1xuaW1wb3J0IHsgQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeVJlc3VsdCwgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgfSBmcm9tICcuL2NvZGVwaXBlbGluZS1hY3Rpb24tZmFjdG9yeSc7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgaW50ZXJmYWNlIENvZGVQaXBlbGluZVByb3BzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHN5bnRoOiBJRmlsZVNldFByb2R1Y2VyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgcGlwZWxpbmVOYW1lPzogc3RyaW5nO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBjcm9zc0FjY291bnRLZXlzPzogYm9vbGVhbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgY2xpVmVyc2lvbj86IHN0cmluZztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgc2VsZk11dGF0aW9uPzogYm9vbGVhbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgZG9ja2VyRW5hYmxlZEZvclNlbGZNdXRhdGlvbj86IGJvb2xlYW47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBkb2NrZXJFbmFibGVkRm9yU3ludGg/OiBib29sZWFuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgY29kZUJ1aWxkRGVmYXVsdHM/OiBDb2RlQnVpbGRPcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBzeW50aENvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgYXNzZXRQdWJsaXNoaW5nQ29kZUJ1aWxkRGVmYXVsdHM/OiBDb2RlQnVpbGRPcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBzZWxmTXV0YXRpb25Db2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHB1Ymxpc2hBc3NldHNJblBhcmFsbGVsPzogYm9vbGVhbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBkb2NrZXJDcmVkZW50aWFscz86IERvY2tlckNyZWRlbnRpYWxbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGNvZGVQaXBlbGluZT86IGNwLlBpcGVsaW5lO1xufVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgaW50ZXJmYWNlIENvZGVCdWlsZE9wdGlvbnMge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGJ1aWxkRW52aXJvbm1lbnQ/OiBjYi5CdWlsZEVudmlyb25tZW50O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgcm9sZVBvbGljeT86IGlhbS5Qb2xpY3lTdGF0ZW1lbnRbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgcGFydGlhbEJ1aWxkU3BlYz86IGNiLkJ1aWxkU3BlYztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBzZWN1cml0eUdyb3Vwcz86IGVjMi5JU2VjdXJpdHlHcm91cFtdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgdnBjPzogZWMyLklWcGM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHN1Ym5ldFNlbGVjdGlvbj86IGVjMi5TdWJuZXRTZWxlY3Rpb247XG59XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgY2xhc3MgQ29kZVBpcGVsaW5lIGV4dGVuZHMgUGlwZWxpbmVCYXNlIHtcbiAgcHJpdmF0ZSBfcGlwZWxpbmU/OiBjcC5QaXBlbGluZTtcbiAgcHJpdmF0ZSBhcnRpZmFjdHMgPSBuZXcgQXJ0aWZhY3RNYXAoKTtcbiAgcHJpdmF0ZSBfc3ludGhQcm9qZWN0PzogY2IuSVByb2plY3Q7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2VsZk11dGF0aW9uOiBib29sZWFuO1xuICBwcml2YXRlIF9teUN4QXNtUm9vdD86IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBkb2NrZXJDcmVkZW50aWFsczogRG9ja2VyQ3JlZGVudGlhbFtdO1xuXG4gIC8qKlxuICAgKiBBc3NldCByb2xlcyBzaGFyZWQgZm9yIHB1Ymxpc2hpbmdcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgYXNzZXRDb2RlQnVpbGRSb2xlczogUmVjb3JkPHN0cmluZywgaWFtLklSb2xlPiA9IHt9O1xuXG4gIC8qKlxuICAgKiBQZXIgYXNzZXQgdHlwZSwgdGhlIHRhcmdldCByb2xlIEFSTnMgdGhhdCBuZWVkIHRvIGJlIGFzc3VtZWRcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgYXNzZXRQdWJsaXNoaW5nUm9sZXM6IFJlY29yZDxzdHJpbmcsIFNldDxzdHJpbmc+PiA9IHt9O1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHNldCB0byB0aGUgdmVyeSBmaXJzdCBhcnRpZmFjdCBwcm9kdWNlZCBpbiB0aGUgcGlwZWxpbmVcbiAgICovXG4gIHByaXZhdGUgX2ZhbGxiYWNrQXJ0aWZhY3Q/OiBjcC5BcnRpZmFjdDtcblxuICBwcml2YXRlIF9jbG91ZEFzc2VtYmx5RmlsZVNldD86IEZpbGVTZXQ7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBzaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGU6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJpdmF0ZSByZWFkb25seSBwcm9wczogQ29kZVBpcGVsaW5lUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIHRoaXMuc2VsZk11dGF0aW9uID0gcHJvcHMuc2VsZk11dGF0aW9uID8/IHRydWU7XG4gICAgdGhpcy5kb2NrZXJDcmVkZW50aWFscyA9IHByb3BzLmRvY2tlckNyZWRlbnRpYWxzID8/IFtdO1xuICAgIHRoaXMuc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlID0gIShwcm9wcy5wdWJsaXNoQXNzZXRzSW5QYXJhbGxlbCA/PyB0cnVlKTtcbiAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICBwdWJsaWMgZ2V0IHN5bnRoUHJvamVjdCgpOiBjYi5JUHJvamVjdCB7XG4gICAgaWYgKCF0aGlzLl9zeW50aFByb2plY3QpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbCBwaXBlbGluZS5idWlsZFBpcGVsaW5lKCkgYmVmb3JlIHJlYWRpbmcgdGhpcyBwcm9wZXJ0eScpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fc3ludGhQcm9qZWN0O1xuICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIGdldCBwaXBlbGluZSgpOiBjcC5QaXBlbGluZSB7XG4gICAgaWYgKCF0aGlzLl9waXBlbGluZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQaXBlbGluZSBub3QgY3JlYXRlZCB5ZXQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3BpcGVsaW5lO1xuICB9XG5cblxuICBwcm90ZWN0ZWQgZG9CdWlsZFBpcGVsaW5lKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9waXBlbGluZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQaXBlbGluZSBhbHJlYWR5IGNyZWF0ZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLl9teUN4QXNtUm9vdCA9IHBhdGgucmVzb2x2ZShhc3NlbWJseUJ1aWxkZXJPZihhcHBPZih0aGlzKSkub3V0ZGlyKTtcblxuICAgIGlmICh0aGlzLnByb3BzLmNvZGVQaXBlbGluZSkge1xuICAgICAgaWYgKHRoaXMucHJvcHMucGlwZWxpbmVOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBcXCdwaXBlbGluZU5hbWVcXCcgaWYgYW4gZXhpc3RpbmcgQ29kZVBpcGVsaW5lIGlzIGdpdmVuIHVzaW5nIFxcJ2NvZGVQaXBlbGluZVxcJycpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucHJvcHMuY3Jvc3NBY2NvdW50S2V5cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBcXCdjcm9zc0FjY291bnRLZXlzXFwnIGlmIGFuIGV4aXN0aW5nIENvZGVQaXBlbGluZSBpcyBnaXZlbiB1c2luZyBcXCdjb2RlUGlwZWxpbmVcXCcnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fcGlwZWxpbmUgPSB0aGlzLnByb3BzLmNvZGVQaXBlbGluZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcGlwZWxpbmUgPSBuZXcgY3AuUGlwZWxpbmUodGhpcywgJ1BpcGVsaW5lJywge1xuICAgICAgICBwaXBlbGluZU5hbWU6IHRoaXMucHJvcHMucGlwZWxpbmVOYW1lLFxuICAgICAgICBjcm9zc0FjY291bnRLZXlzOiB0aGlzLnByb3BzLmNyb3NzQWNjb3VudEtleXMgPz8gZmFsc2UsXG4gICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIG1ha2Ugc2VsZi1tdXRhdGlvbiB3b3JrIChkZXBsb3ltZW50cyBhcmUgZ3VhcmFudGVlZFxuICAgICAgICAvLyB0byBoYXBwZW4gb25seSBhZnRlciB0aGUgYnVpbGRzIG9mIHRoZSBsYXRlc3QgcGlwZWxpbmUgZGVmaW5pdGlvbikuXG4gICAgICAgIHJlc3RhcnRFeGVjdXRpb25PblVwZGF0ZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGdyYXBoRnJvbUJwID0gbmV3IFBpcGVsaW5lR3JhcGgodGhpcywge1xuICAgICAgc2VsZk11dGF0aW9uOiB0aGlzLnNlbGZNdXRhdGlvbixcbiAgICAgIHNpbmdsZVB1Ymxpc2hlclBlckFzc2V0VHlwZTogdGhpcy5zaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGUsXG4gICAgfSk7XG4gICAgdGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQgPSBncmFwaEZyb21CcC5jbG91ZEFzc2VtYmx5RmlsZVNldDtcblxuICAgIHRoaXMucGlwZWxpbmVTdGFnZXNBbmRBY3Rpb25zRnJvbUdyYXBoKGdyYXBoRnJvbUJwKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG15Q3hBc21Sb290KCk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLl9teUN4QXNtUm9vdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IHJlYWQgXFwnbXlDeEFzbVJvb3RcXCcgaWYgYnVpbGQgZGVwbG95bWVudCBub3QgY2FsbGVkIHlldCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fbXlDeEFzbVJvb3Q7XG4gIH1cblxuICAvKipcbiAgICogU2NvcGUgZm9yIEFzc2V0cy1yZWxhdGVkIHJlc291cmNlcy5cbiAgICpcbiAgICogUHVyZWx5IGV4aXN0cyBmb3IgY29uc3RydWN0IHRyZWUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBsZWdhY3kgcGlwZWxpbmVzXG4gICAqL1xuICBwcml2YXRlIGdldCBhc3NldHNTY29wZSgpOiBDb25zdHJ1Y3Qge1xuICAgIHJldHVybiBvYnRhaW5TY29wZSh0aGlzLCAnQXNzZXRzJyk7XG4gIH1cblxuICBwcml2YXRlIHBpcGVsaW5lU3RhZ2VzQW5kQWN0aW9uc0Zyb21HcmFwaChzdHJ1Y3R1cmU6IFBpcGVsaW5lR3JhcGgpIHtcbiAgICAvLyBUcmFuc2xhdGUgZ3JhcGggaW50byBQaXBlbGluZSBTdGFnZXMgYW5kIEFjdGlvbnNcbiAgICBsZXQgYmVmb3JlU2VsZk11dGF0aW9uID0gdGhpcy5zZWxmTXV0YXRpb247XG4gICAgZm9yIChjb25zdCBzdGFnZU5vZGUgb2YgZmxhdHRlbihzdHJ1Y3R1cmUuZ3JhcGguc29ydGVkQ2hpbGRyZW4oKSkpIHtcbiAgICAgIGlmICghaXNHcmFwaChzdGFnZU5vZGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9wLWxldmVsIGNoaWxkcmVuIG11c3QgYmUgZ3JhcGhzLCBnb3QgJyR7c3RhZ2VOb2RlfSdgKTtcbiAgICAgIH1cblxuICAgICAgLy8gR3JvdXAgb3VyIG9yZGVyZWQgdHJhbmNoZXMgaW50byBibG9ja3Mgb2YgNTAuXG4gICAgICAvLyBXZSBjYW4gbWFwIHRoZXNlIG9udG8gc3RhZ2VzIHdpdGhvdXQgZXhjZWVkaW5nIHRoZSBjYXBhY2l0eSBvZiBhIFN0YWdlLlxuICAgICAgY29uc3QgY2h1bmtzID0gY2h1bmtUcmFuY2hlcyg1MCwgc3RhZ2VOb2RlLnNvcnRlZExlYXZlcygpKTtcbiAgICAgIGNvbnN0IGFjdGlvbnNPdmVyZmxvd1N0YWdlID0gY2h1bmtzLmxlbmd0aCA+IDE7XG4gICAgICBmb3IgKGNvbnN0IFtpLCB0cmFuY2hlc10gb2YgZW51bWVyYXRlKGNodW5rcykpIHtcbiAgICAgICAgY29uc3Qgc3RhZ2VOYW1lID0gYWN0aW9uc092ZXJmbG93U3RhZ2UgPyBgJHtzdGFnZU5vZGUuaWR9LiR7aSArIDF9YCA6IHN0YWdlTm9kZS5pZDtcbiAgICAgICAgY29uc3QgcGlwZWxpbmVTdGFnZSA9IHRoaXMucGlwZWxpbmUuYWRkU3RhZ2UoeyBzdGFnZU5hbWUgfSk7XG5cbiAgICAgICAgY29uc3Qgc2hhcmVkUGFyZW50ID0gbmV3IEdyYXBoTm9kZUNvbGxlY3Rpb24oZmxhdHRlbih0cmFuY2hlcykpLmNvbW1vbkFuY2VzdG9yKCk7XG5cbiAgICAgICAgbGV0IHJ1bk9yZGVyID0gMTtcbiAgICAgICAgZm9yIChjb25zdCB0cmFuY2hlIG9mIHRyYW5jaGVzKSB7XG4gICAgICAgICAgY29uc3QgcnVuT3JkZXJzQ29uc3VtZWQgPSBbMF07XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdHJhbmNoZSkge1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuYWN0aW9uRnJvbU5vZGUobm9kZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LnByb2R1Y2VBY3Rpb24ocGlwZWxpbmVTdGFnZSwge1xuICAgICAgICAgICAgICBhY3Rpb25OYW1lOiBhY3Rpb25OYW1lKG5vZGUsIHNoYXJlZFBhcmVudCksXG4gICAgICAgICAgICAgIHJ1bk9yZGVyLFxuICAgICAgICAgICAgICBhcnRpZmFjdHM6IHRoaXMuYXJ0aWZhY3RzLFxuICAgICAgICAgICAgICBzY29wZTogb2J0YWluU2NvcGUodGhpcy5waXBlbGluZSwgc3RhZ2VOYW1lKSxcbiAgICAgICAgICAgICAgZmFsbGJhY2tBcnRpZmFjdDogdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCxcbiAgICAgICAgICAgICAgcGlwZWxpbmU6IHRoaXMsXG4gICAgICAgICAgICAgIC8vIElmIHRoaXMgc3RlcCBoYXBwZW5zIHRvIHByb2R1Y2UgYSBDb2RlQnVpbGQgam9iLCBzZXQgdGhlIGRlZmF1bHQgb3B0aW9uc1xuICAgICAgICAgICAgICBjb2RlQnVpbGREZWZhdWx0czogbm9kZVR5cGUgPyB0aGlzLmNvZGVCdWlsZERlZmF1bHRzRm9yKG5vZGVUeXBlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgYmVmb3JlU2VsZk11dGF0aW9uLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChub2RlLmRhdGE/LnR5cGUgPT09ICdzZWxmLXVwZGF0ZScpIHtcbiAgICAgICAgICAgICAgYmVmb3JlU2VsZk11dGF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucG9zdFByb2Nlc3NOb2RlKG5vZGUsIHJlc3VsdCk7XG5cbiAgICAgICAgICAgIHJ1bk9yZGVyc0NvbnN1bWVkLnB1c2gocmVzdWx0LnJ1bk9yZGVyc0NvbnN1bWVkKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBydW5PcmRlciArPSBNYXRoLm1heCguLi5ydW5PcmRlcnNDb25zdW1lZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRG8gYWRkaXRpb25hbCB0aGluZ3MgYWZ0ZXIgdGhlIGFjdGlvbiBnb3QgYWRkZWQgdG8gdGhlIHBpcGVsaW5lXG4gICAqXG4gICAqIFNvbWUgbWlub3Igc3RhdGUgbWFuaXB1bGF0aW9uIG9mIENvZGVCdWlsZCBwcm9qZWN0cyBhbmQgcGlwZWxpbmVcbiAgICogYXJ0aWZhY3RzLlxuICAgKi9cbiAgcHJpdmF0ZSBwb3N0UHJvY2Vzc05vZGUobm9kZTogQUdyYXBoTm9kZSwgcmVzdWx0OiBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5UmVzdWx0KSB7XG4gICAgY29uc3Qgbm9kZVR5cGUgPSB0aGlzLm5vZGVUeXBlRnJvbU5vZGUobm9kZSk7XG5cbiAgICBpZiAocmVzdWx0LnByb2plY3QpIHtcbiAgICAgIGNvbnN0IGRvY2tlclVzYWdlID0gZG9ja2VyVXNhZ2VGcm9tQ29kZUJ1aWxkKG5vZGVUeXBlID8/IENvZGVCdWlsZFByb2plY3RUeXBlLlNURVApO1xuICAgICAgaWYgKGRvY2tlclVzYWdlKSB7XG4gICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLmRvY2tlckNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgYy5ncmFudFJlYWQocmVzdWx0LnByb2plY3QsIGRvY2tlclVzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobm9kZVR5cGUgPT09IENvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIKSB7XG4gICAgICAgIHRoaXMuX3N5bnRoUHJvamVjdCA9IHJlc3VsdC5wcm9qZWN0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChub2RlLmRhdGE/LnR5cGUgPT09ICdzdGVwJyAmJiBub2RlLmRhdGEuc3RlcC5wcmltYXJ5T3V0cHV0Py5wcmltYXJ5T3V0cHV0ICYmICF0aGlzLl9mYWxsYmFja0FydGlmYWN0KSB7XG4gICAgICB0aGlzLl9mYWxsYmFja0FydGlmYWN0ID0gdGhpcy5hcnRpZmFjdHMudG9Db2RlUGlwZWxpbmUobm9kZS5kYXRhLnN0ZXAucHJpbWFyeU91dHB1dD8ucHJpbWFyeU91dHB1dCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1ha2UgYW4gYWN0aW9uIGZyb20gdGhlIGdpdmVuIG5vZGUgYW5kL29yIHN0ZXBcbiAgICovXG4gIHByaXZhdGUgYWN0aW9uRnJvbU5vZGUobm9kZTogQUdyYXBoTm9kZSk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBzd2l0Y2ggKG5vZGUuZGF0YT8udHlwZSkge1xuICAgICAgLy8gTm90aGluZyBmb3IgdGhlc2UsIHRoZXkgYXJlIGdyb3VwaW5ncyAoc2hvdWxkbid0IGV2ZW4gaGF2ZSBwb3BwZWQgdXAgaGVyZSlcbiAgICAgIGNhc2UgJ2dyb3VwJzpcbiAgICAgIGNhc2UgJ3N0YWNrLWdyb3VwJzpcbiAgICAgIGNhc2UgdW5kZWZpbmVkOlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGFjdGlvbkZyb21Ob2RlOiBkaWQgbm90IGV4cGVjdCB0byBnZXQgZ3JvdXAgbm9kZXM6ICR7bm9kZS5kYXRhPy50eXBlfWApO1xuXG4gICAgICBjYXNlICdzZWxmLXVwZGF0ZSc6XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGZNdXRhdGVBY3Rpb24oKTtcblxuICAgICAgY2FzZSAncHVibGlzaC1hc3NldHMnOlxuICAgICAgICByZXR1cm4gdGhpcy5wdWJsaXNoQXNzZXRzQWN0aW9uKG5vZGUsIG5vZGUuZGF0YS5hc3NldHMpO1xuXG4gICAgICBjYXNlICdwcmVwYXJlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQ2hhbmdlU2V0QWN0aW9uKG5vZGUuZGF0YS5zdGFjayk7XG5cbiAgICAgIGNhc2UgJ2V4ZWN1dGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlQ2hhbmdlU2V0QWN0aW9uKG5vZGUuZGF0YS5zdGFjaywgbm9kZS5kYXRhLmNhcHR1cmVPdXRwdXRzKTtcblxuICAgICAgY2FzZSAnc3RlcCc6XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbkZyb21TdGVwKG5vZGUsIG5vZGUuZGF0YS5zdGVwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhIFN0ZXAgYW5kIHR1cm4gaXQgaW50byBhIENvZGVQaXBlbGluZSBBY3Rpb25cbiAgICpcbiAgICogVGhlcmUgYXJlIG9ubHkgMyB0eXBlcyBvZiBTdGVwcyB3ZSBuZWVkIHRvIHN1cHBvcnQ6XG4gICAqXG4gICAqIC0gU2hlbGwgKGdlbmVyaWMpXG4gICAqIC0gTWFudWFsQXBwcm92YWwgKGdlbmVyaWMpXG4gICAqIC0gQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSAoQ29kZVBpcGVsaW5lLXNwZWNpZmljKVxuICAgKlxuICAgKiBUaGUgcmVzdCBpcyBleHByZXNzZWQgaW4gdGVybXMgb2YgdGhlc2UgMywgb3IgaW4gdGVybXMgb2YgZ3JhcGggbm9kZXNcbiAgICogd2hpY2ggYXJlIGhhbmRsZWQgZWxzZXdoZXJlLlxuICAgKi9cbiAgcHJpdmF0ZSBhY3Rpb25Gcm9tU3RlcChub2RlOiBBR3JhcGhOb2RlLCBzdGVwOiBTdGVwKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuXG4gICAgLy8gQ29kZVBpcGVsaW5lLXNwZWNpZmljIHN0ZXBzIGZpcnN0IC0tIHRoaXMgaW5jbHVkZXMgU291cmNlc1xuICAgIGlmIChpc0NvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkoc3RlcCkpIHtcbiAgICAgIHJldHVybiBzdGVwO1xuICAgIH1cblxuICAgIC8vIE5vdyBidWlsdC1pbiBzdGVwc1xuICAgIGlmIChzdGVwIGluc3RhbmNlb2YgU2hlbGxTdGVwIHx8IHN0ZXAgaW5zdGFuY2VvZiBDb2RlQnVpbGRTdGVwKSB7XG4gICAgICAvLyBUaGUgJ0Nka0J1aWxkUHJvamVjdCcgd2lsbCBiZSB0aGUgY29uc3RydWN0IElEIG9mIHRoZSBDb2RlQnVpbGQgcHJvamVjdCwgbmVjZXNzYXJ5IGZvciBiYWNrd2FyZHMgY29tcGF0XG4gICAgICBsZXQgY29uc3RydWN0SWQgPSBub2RlVHlwZSA9PT0gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEhcbiAgICAgICAgPyAnQ2RrQnVpbGRQcm9qZWN0J1xuICAgICAgICA6IHN0ZXAuaWQ7XG5cbiAgICAgIHJldHVybiBzdGVwIGluc3RhbmNlb2YgQ29kZUJ1aWxkU3RlcFxuICAgICAgICA/IENvZGVCdWlsZEZhY3RvcnkuZnJvbUNvZGVCdWlsZFN0ZXAoY29uc3RydWN0SWQsIHN0ZXApXG4gICAgICAgIDogQ29kZUJ1aWxkRmFjdG9yeS5mcm9tU2hlbGxTdGVwKGNvbnN0cnVjdElkLCBzdGVwKTtcbiAgICB9XG5cbiAgICBpZiAoc3RlcCBpbnN0YW5jZW9mIE1hbnVhbEFwcHJvdmFsU3RlcCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZHVjZUFjdGlvbjogKHN0YWdlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgICAgc3RhZ2UuYWRkQWN0aW9uKG5ldyBjcGEuTWFudWFsQXBwcm92YWxBY3Rpb24oe1xuICAgICAgICAgICAgYWN0aW9uTmFtZTogb3B0aW9ucy5hY3Rpb25OYW1lLFxuICAgICAgICAgICAgcnVuT3JkZXI6IG9wdGlvbnMucnVuT3JkZXIsXG4gICAgICAgICAgICBhZGRpdGlvbmFsSW5mb3JtYXRpb246IHN0ZXAuY29tbWVudCxcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgcmV0dXJuIHsgcnVuT3JkZXJzQ29uc3VtZWQ6IDEgfTtcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBEZXBsb3ltZW50IHN0ZXAgJyR7c3RlcH0nIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIENvZGVQaXBlbGluZS1iYWNrZWQgcGlwZWxpbmVzYCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNoYW5nZVNldEFjdGlvbihzdGFjazogU3RhY2tEZXBsb3ltZW50KTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGNoYW5nZVNldE5hbWUgPSAnUGlwZWxpbmVDaGFuZ2UnO1xuXG4gICAgY29uc3QgdGVtcGxhdGVBcnRpZmFjdCA9IHRoaXMuYXJ0aWZhY3RzLnRvQ29kZVBpcGVsaW5lKHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0ISk7XG4gICAgY29uc3QgdGVtcGxhdGVDb25maWd1cmF0aW9uUGF0aCA9IHRoaXMud3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24oc3RhY2spO1xuXG4gICAgY29uc3QgcmVnaW9uID0gc3RhY2sucmVnaW9uICE9PSBTdGFjay5vZih0aGlzKS5yZWdpb24gPyBzdGFjay5yZWdpb24gOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgYWNjb3VudCA9IHN0YWNrLmFjY291bnQgIT09IFN0YWNrLm9mKHRoaXMpLmFjY291bnQgPyBzdGFjay5hY2NvdW50IDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgcmVsYXRpdmVUZW1wbGF0ZVBhdGggPSBwYXRoLnJlbGF0aXZlKHRoaXMubXlDeEFzbVJvb3QsIHN0YWNrLmFic29sdXRlVGVtcGxhdGVQYXRoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBwcm9kdWNlQWN0aW9uOiAoc3RhZ2UsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgc3RhZ2UuYWRkQWN0aW9uKG5ldyBjcGEuQ2xvdWRGb3JtYXRpb25DcmVhdGVSZXBsYWNlQ2hhbmdlU2V0QWN0aW9uKHtcbiAgICAgICAgICBhY3Rpb25OYW1lOiBvcHRpb25zLmFjdGlvbk5hbWUsXG4gICAgICAgICAgcnVuT3JkZXI6IG9wdGlvbnMucnVuT3JkZXIsXG4gICAgICAgICAgY2hhbmdlU2V0TmFtZSxcbiAgICAgICAgICBzdGFja05hbWU6IHN0YWNrLnN0YWNrTmFtZSxcbiAgICAgICAgICB0ZW1wbGF0ZVBhdGg6IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHJlbGF0aXZlVGVtcGxhdGVQYXRoKSksXG4gICAgICAgICAgYWRtaW5QZXJtaXNzaW9uczogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB0aGlzLnJvbGVGcm9tUGxhY2Vob2xkZXJBcm4odGhpcy5waXBlbGluZSwgcmVnaW9uLCBhY2NvdW50LCBzdGFjay5hc3N1bWVSb2xlQXJuKSxcbiAgICAgICAgICBkZXBsb3ltZW50Um9sZTogdGhpcy5yb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHRoaXMucGlwZWxpbmUsIHJlZ2lvbiwgYWNjb3VudCwgc3RhY2suZXhlY3V0aW9uUm9sZUFybiksXG4gICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb25QYXRoXG4gICAgICAgICAgICA/IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGgpKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgY2ZuQ2FwYWJpbGl0aWVzOiBbQ2ZuQ2FwYWJpbGl0aWVzLk5BTUVEX0lBTSwgQ2ZuQ2FwYWJpbGl0aWVzLkFVVE9fRVhQQU5EXSxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBleGVjdXRlQ2hhbmdlU2V0QWN0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQsIGNhcHR1cmVPdXRwdXRzOiBib29sZWFuKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGNoYW5nZVNldE5hbWUgPSAnUGlwZWxpbmVDaGFuZ2UnO1xuXG4gICAgY29uc3QgcmVnaW9uID0gc3RhY2sucmVnaW9uICE9PSBTdGFjay5vZih0aGlzKS5yZWdpb24gPyBzdGFjay5yZWdpb24gOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgYWNjb3VudCA9IHN0YWNrLmFjY291bnQgIT09IFN0YWNrLm9mKHRoaXMpLmFjY291bnQgPyBzdGFjay5hY2NvdW50IDogdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2R1Y2VBY3Rpb246IChzdGFnZSwgb3B0aW9ucykgPT4ge1xuICAgICAgICBzdGFnZS5hZGRBY3Rpb24obmV3IGNwYS5DbG91ZEZvcm1hdGlvbkV4ZWN1dGVDaGFuZ2VTZXRBY3Rpb24oe1xuICAgICAgICAgIGFjdGlvbk5hbWU6IG9wdGlvbnMuYWN0aW9uTmFtZSxcbiAgICAgICAgICBydW5PcmRlcjogb3B0aW9ucy5ydW5PcmRlcixcbiAgICAgICAgICBjaGFuZ2VTZXROYW1lLFxuICAgICAgICAgIHN0YWNrTmFtZTogc3RhY2suc3RhY2tOYW1lLFxuICAgICAgICAgIHJvbGU6IHRoaXMucm9sZUZyb21QbGFjZWhvbGRlckFybih0aGlzLnBpcGVsaW5lLCByZWdpb24sIGFjY291bnQsIHN0YWNrLmFzc3VtZVJvbGVBcm4pLFxuICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgIHZhcmlhYmxlc05hbWVzcGFjZTogY2FwdHVyZU91dHB1dHMgPyBzdGFja1ZhcmlhYmxlTmFtZXNwYWNlKHN0YWNrKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHJldHVybiB7IHJ1bk9yZGVyc0NvbnN1bWVkOiAxIH07XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHNlbGZNdXRhdGVBY3Rpb24oKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGluc3RhbGxTdWZmaXggPSB0aGlzLnByb3BzLmNsaVZlcnNpb24gPyBgQCR7dGhpcy5wcm9wcy5jbGlWZXJzaW9ufWAgOiAnJztcblxuICAgIGNvbnN0IHBpcGVsaW5lU3RhY2sgPSBTdGFjay5vZih0aGlzLnBpcGVsaW5lKTtcbiAgICBjb25zdCBwaXBlbGluZVN0YWNrSWRlbnRpZmllciA9IHBpcGVsaW5lU3RhY2subm9kZS5wYXRoID8/IHBpcGVsaW5lU3RhY2suc3RhY2tOYW1lO1xuXG4gICAgY29uc3Qgc3RlcCA9IG5ldyBDb2RlQnVpbGRTdGVwKCdTZWxmTXV0YXRlJywge1xuICAgICAgcHJvamVjdE5hbWU6IG1heWJlU3VmZml4KHRoaXMucHJvcHMucGlwZWxpbmVOYW1lLCAnLXNlbGZ1cGRhdGUnKSxcbiAgICAgIGlucHV0OiB0aGlzLl9jbG91ZEFzc2VtYmx5RmlsZVNldCxcbiAgICAgIGluc3RhbGxDb21tYW5kczogW1xuICAgICAgICBgbnBtIGluc3RhbGwgLWcgYXdzLWNkayR7aW5zdGFsbFN1ZmZpeH1gLFxuICAgICAgXSxcbiAgICAgIGNvbW1hbmRzOiBbXG4gICAgICAgIGBjZGsgLWEgJHt0b1Bvc2l4UGF0aChlbWJlZGRlZEFzbVBhdGgodGhpcy5waXBlbGluZSkpfSBkZXBsb3kgJHtwaXBlbGluZVN0YWNrSWRlbnRpZmllcn0gLS1yZXF1aXJlLWFwcHJvdmFsPW5ldmVyIC0tdmVyYm9zZWAsXG4gICAgICBdLFxuXG4gICAgICByb2xlUG9saWN5U3RhdGVtZW50czogW1xuICAgICAgICAvLyBhbGxvdyB0aGUgc2VsZi1tdXRhdGluZyBwcm9qZWN0IHBlcm1pc3Npb25zIHRvIGFzc3VtZSB0aGUgYm9vdHN0cmFwIEFjdGlvbiByb2xlXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3N0czpBc3N1bWVSb2xlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbYGFybjoqOmlhbTo6JHtTdGFjay5vZih0aGlzLnBpcGVsaW5lKS5hY2NvdW50fTpyb2xlLypgXSxcbiAgICAgICAgICBjb25kaXRpb25zOiB7XG4gICAgICAgICAgICAnRm9yQW55VmFsdWU6U3RyaW5nRXF1YWxzJzoge1xuICAgICAgICAgICAgICAnaWFtOlJlc291cmNlVGFnL2F3cy1jZGs6Ym9vdHN0cmFwLXJvbGUnOiBbJ2ltYWdlLXB1Ymxpc2hpbmcnLCAnZmlsZS1wdWJsaXNoaW5nJywgJ2RlcGxveSddLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnY2xvdWRmb3JtYXRpb246RGVzY3JpYmVTdGFja3MnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLCAvLyB0aGlzIGlzIG5lZWRlZCB0byBjaGVjayB0aGUgc3RhdHVzIG9mIHRoZSBib290c3RyYXAgc3RhY2sgd2hlbiBkb2luZyBgY2RrIGRlcGxveWBcbiAgICAgICAgfSksXG4gICAgICAgIC8vIFMzIGNoZWNrcyBmb3IgdGhlIHByZXNlbmNlIG9mIHRoZSBMaXN0QnVja2V0IHBlcm1pc3Npb25cbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnczM6TGlzdEJ1Y2tldCddLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIERpZmZlcmVudCBvbiBwdXJwb3NlIC0tIGlkIG5lZWRlZCBmb3IgYmFja3dhcmRzIGNvbXBhdGlibGUgTG9naWNhbElEXG4gICAgcmV0dXJuIENvZGVCdWlsZEZhY3RvcnkuZnJvbUNvZGVCdWlsZFN0ZXAoJ1NlbGZNdXRhdGlvbicsIHN0ZXAsIHtcbiAgICAgIGFkZGl0aW9uYWxDb25zdHJ1Y3RMZXZlbDogZmFsc2UsXG4gICAgICBzY29wZTogb2J0YWluU2NvcGUodGhpcywgJ1VwZGF0ZVBpcGVsaW5lJyksXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHB1Ymxpc2hBc3NldHNBY3Rpb24obm9kZTogQUdyYXBoTm9kZSwgYXNzZXRzOiBTdGFja0Fzc2V0W10pOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgY29uc3QgaW5zdGFsbFN1ZmZpeCA9IHRoaXMucHJvcHMuY2xpVmVyc2lvbiA/IGBAJHt0aGlzLnByb3BzLmNsaVZlcnNpb259YCA6ICcnO1xuXG4gICAgY29uc3QgY29tbWFuZHMgPSBhc3NldHMubWFwKGFzc2V0ID0+IHtcbiAgICAgIGNvbnN0IHJlbGF0aXZlQXNzZXRNYW5pZmVzdFBhdGggPSBwYXRoLnJlbGF0aXZlKHRoaXMubXlDeEFzbVJvb3QsIGFzc2V0LmFzc2V0TWFuaWZlc3RQYXRoKTtcbiAgICAgIHJldHVybiBgY2RrLWFzc2V0cyAtLXBhdGggXCIke3RvUG9zaXhQYXRoKHJlbGF0aXZlQXNzZXRNYW5pZmVzdFBhdGgpfVwiIC0tdmVyYm9zZSBwdWJsaXNoIFwiJHthc3NldC5hc3NldFNlbGVjdG9yfVwiYDtcbiAgICB9KTtcblxuICAgIGNvbnN0IGFzc2V0VHlwZSA9IGFzc2V0c1swXS5hc3NldFR5cGU7XG4gICAgaWYgKGFzc2V0cy5zb21lKGEgPT4gYS5hc3NldFR5cGUgIT09IGFzc2V0VHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWxsIGFzc2V0cyBpbiBhIHNpbmdsZSBwdWJsaXNoaW5nIHN0ZXAgbXVzdCBiZSBvZiB0aGUgc2FtZSB0eXBlJyk7XG4gICAgfVxuXG4gICAgY29uc3QgcHVibGlzaGluZ1JvbGVzID0gdGhpcy5hc3NldFB1Ymxpc2hpbmdSb2xlc1thc3NldFR5cGVdID0gKHRoaXMuYXNzZXRQdWJsaXNoaW5nUm9sZXNbYXNzZXRUeXBlXSA/PyBuZXcgU2V0KCkpO1xuICAgIGZvciAoY29uc3QgYXNzZXQgb2YgYXNzZXRzKSB7XG4gICAgICBpZiAoYXNzZXQuYXNzZXRQdWJsaXNoaW5nUm9sZUFybikge1xuICAgICAgICBwdWJsaXNoaW5nUm9sZXMuYWRkKGFzc2V0LmFzc2V0UHVibGlzaGluZ1JvbGVBcm4pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJvbGUgPSB0aGlzLm9idGFpbkFzc2V0Q29kZUJ1aWxkUm9sZShhc3NldHNbMF0uYXNzZXRUeXBlKTtcblxuICAgIC8vIFRoZSBiYXNlIGNvbW1hbmRzIHRoYXQgbmVlZCB0byBiZSBydW5cbiAgICBjb25zdCBzY3JpcHQgPSBuZXcgQ29kZUJ1aWxkU3RlcChub2RlLmlkLCB7XG4gICAgICBjb21tYW5kcyxcbiAgICAgIGluc3RhbGxDb21tYW5kczogW1xuICAgICAgICBgbnBtIGluc3RhbGwgLWcgY2RrLWFzc2V0cyR7aW5zdGFsbFN1ZmZpeH1gLFxuICAgICAgXSxcbiAgICAgIGlucHV0OiB0aGlzLl9jbG91ZEFzc2VtYmx5RmlsZVNldCxcbiAgICAgIGJ1aWxkRW52aXJvbm1lbnQ6IHtcbiAgICAgICAgcHJpdmlsZWdlZDogYXNzZXRzLnNvbWUoYXNzZXQgPT4gYXNzZXQuYXNzZXRUeXBlID09PSBBc3NldFR5cGUuRE9DS0VSX0lNQUdFKSxcbiAgICAgIH0sXG4gICAgICByb2xlLFxuICAgIH0pO1xuXG4gICAgLy8gQ3VzdG9taXphdGlvbnMgdGhhdCBhcmUgbm90IGFjY2Vzc2libGUgdG8gcmVndWxhciB1c2Vyc1xuICAgIHJldHVybiBDb2RlQnVpbGRGYWN0b3J5LmZyb21Db2RlQnVpbGRTdGVwKG5vZGUuaWQsIHNjcmlwdCwge1xuICAgICAgYWRkaXRpb25hbENvbnN0cnVjdExldmVsOiBmYWxzZSxcblxuICAgICAgLy8gSWYgd2UgdXNlIGEgc2luZ2xlIHB1Ymxpc2hlciwgcGFzcyBidWlsZHNwZWMgdmlhIGZpbGUgb3RoZXJ3aXNlIGl0J2xsXG4gICAgICAvLyBncm93IHRvbyBiaWcuXG4gICAgICBwYXNzQnVpbGRTcGVjVmlhQ2xvdWRBc3NlbWJseTogdGhpcy5zaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGUsXG4gICAgICBzY29wZTogdGhpcy5hc3NldHNTY29wZSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgbm9kZVR5cGVGcm9tTm9kZShub2RlOiBBR3JhcGhOb2RlKSB7XG4gICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3N0ZXAnKSB7XG4gICAgICByZXR1cm4gISFub2RlLmRhdGE/LmlzQnVpbGRTdGVwID8gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEggOiBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TVEVQO1xuICAgIH1cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAncHVibGlzaC1hc3NldHMnKSB7XG4gICAgICByZXR1cm4gQ29kZUJ1aWxkUHJvamVjdFR5cGUuQVNTRVRTO1xuICAgIH1cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc2VsZi11cGRhdGUnKSB7XG4gICAgICByZXR1cm4gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU0VMRl9NVVRBVEU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGNvZGVCdWlsZERlZmF1bHRzRm9yKG5vZGVUeXBlOiBDb2RlQnVpbGRQcm9qZWN0VHlwZSk6IENvZGVCdWlsZE9wdGlvbnMgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBDb2RlQnVpbGRPcHRpb25zID0ge1xuICAgICAgYnVpbGRFbnZpcm9ubWVudDoge1xuICAgICAgICBidWlsZEltYWdlOiBjYi5MaW51eEJ1aWxkSW1hZ2UuU1RBTkRBUkRfNV8wLFxuICAgICAgICBjb21wdXRlVHlwZTogY2IuQ29tcHV0ZVR5cGUuU01BTEwsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCB0eXBlQmFzZWRDdXN0b21pemF0aW9ucyA9IHtcbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USF06IHRoaXMucHJvcHMuZG9ja2VyRW5hYmxlZEZvclN5bnRoXG4gICAgICAgID8gbWVyZ2VDb2RlQnVpbGRPcHRpb25zKHRoaXMucHJvcHMuc3ludGhDb2RlQnVpbGREZWZhdWx0cywgeyBidWlsZEVudmlyb25tZW50OiB7IHByaXZpbGVnZWQ6IHRydWUgfSB9KVxuICAgICAgICA6IHRoaXMucHJvcHMuc3ludGhDb2RlQnVpbGREZWZhdWx0cyxcblxuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLkFTU0VUU106IHRoaXMucHJvcHMuYXNzZXRQdWJsaXNoaW5nQ29kZUJ1aWxkRGVmYXVsdHMsXG5cbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5TRUxGX01VVEFURV06IHRoaXMucHJvcHMuZG9ja2VyRW5hYmxlZEZvclNlbGZNdXRhdGlvblxuICAgICAgICA/IG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyh0aGlzLnByb3BzLnNlbGZNdXRhdGlvbkNvZGVCdWlsZERlZmF1bHRzLCB7IGJ1aWxkRW52aXJvbm1lbnQ6IHsgcHJpdmlsZWdlZDogdHJ1ZSB9IH0pXG4gICAgICAgIDogdGhpcy5wcm9wcy5zZWxmTXV0YXRpb25Db2RlQnVpbGREZWZhdWx0cyxcblxuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLlNURVBdOiB7fSxcbiAgICB9O1xuXG4gICAgY29uc3QgZG9ja2VyVXNhZ2UgPSBkb2NrZXJVc2FnZUZyb21Db2RlQnVpbGQobm9kZVR5cGUpO1xuICAgIGNvbnN0IGRvY2tlckNvbW1hbmRzID0gZG9ja2VyVXNhZ2UgIT09IHVuZGVmaW5lZFxuICAgICAgPyBkb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcyhkb2NrZXJVc2FnZSwgdGhpcy5kb2NrZXJDcmVkZW50aWFscywgJ2JvdGgnKVxuICAgICAgOiBbXTtcbiAgICBjb25zdCB0eXBlQmFzZWREb2NrZXJDb21tYW5kcyA9IGRvY2tlckNvbW1hbmRzLmxlbmd0aCA+IDAgPyB7XG4gICAgICBwYXJ0aWFsQnVpbGRTcGVjOiBjYi5CdWlsZFNwZWMuZnJvbU9iamVjdCh7XG4gICAgICAgIHZlcnNpb246ICcwLjInLFxuICAgICAgICBwaGFzZXM6IHtcbiAgICAgICAgICBwcmVfYnVpbGQ6IHtcbiAgICAgICAgICAgIGNvbW1hbmRzOiBkb2NrZXJDb21tYW5kcyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSA6IHt9O1xuXG4gICAgcmV0dXJuIG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyhcbiAgICAgIGRlZmF1bHRPcHRpb25zLFxuICAgICAgdGhpcy5wcm9wcy5jb2RlQnVpbGREZWZhdWx0cyxcbiAgICAgIHR5cGVCYXNlZEN1c3RvbWl6YXRpb25zW25vZGVUeXBlXSxcbiAgICAgIHR5cGVCYXNlZERvY2tlckNvbW1hbmRzLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHJvbGVGcm9tUGxhY2Vob2xkZXJBcm4oc2NvcGU6IENvbnN0cnVjdCwgcmVnaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgYWNjb3VudDogc3RyaW5nIHwgdW5kZWZpbmVkLCBhcm46IHN0cmluZyk6IGlhbS5JUm9sZTtcbiAgcHJpdmF0ZSByb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHNjb3BlOiBDb25zdHJ1Y3QsIHJlZ2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIGFjY291bnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgYXJuOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBpYW0uSVJvbGUgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgcm9sZUZyb21QbGFjZWhvbGRlckFybihzY29wZTogQ29uc3RydWN0LCByZWdpb246IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBhY2NvdW50OiBzdHJpbmcgfCB1bmRlZmluZWQsIGFybjogc3RyaW5nIHwgdW5kZWZpbmVkKTogaWFtLklSb2xlIHwgdW5kZWZpbmVkIHtcblxuICAgIGlmICghYXJuKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAgIC8vIFVzZSBwbGFjZWhvbGRlciBhcm4gYXMgY29uc3RydWN0IElELlxuICAgIGNvbnN0IGlkID0gYXJuO1xuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2F3cy9hd3MtY2RrL2lzc3Vlcy83MjU1XG4gICAgbGV0IGV4aXN0aW5nUm9sZSA9IHNjb3BlLm5vZGUudHJ5RmluZENoaWxkKGBJbW11dGFibGVSb2xlJHtpZH1gKSBhcyBpYW0uSVJvbGU7XG4gICAgaWYgKGV4aXN0aW5nUm9sZSkgeyByZXR1cm4gZXhpc3RpbmdSb2xlOyB9XG4gICAgLy8gRm9yIHdoZW4gIzcyNTUgaXMgZml4ZWQuXG4gICAgZXhpc3RpbmdSb2xlID0gc2NvcGUubm9kZS50cnlGaW5kQ2hpbGQoaWQpIGFzIGlhbS5JUm9sZTtcbiAgICBpZiAoZXhpc3RpbmdSb2xlKSB7IHJldHVybiBleGlzdGluZ1JvbGU7IH1cblxuICAgIGNvbnN0IGFyblRvSW1wb3J0ID0gY3hhcGkuRW52aXJvbm1lbnRQbGFjZWhvbGRlcnMucmVwbGFjZShhcm4sIHtcbiAgICAgIHJlZ2lvbjogcmVnaW9uID8/IEF3cy5SRUdJT04sXG4gICAgICBhY2NvdW50SWQ6IGFjY291bnQgPz8gQXdzLkFDQ09VTlRfSUQsXG4gICAgICBwYXJ0aXRpb246IEF3cy5QQVJUSVRJT04sXG4gICAgfSk7XG4gICAgcmV0dXJuIGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHNjb3BlLCBpZCwgYXJuVG9JbXBvcnQsIHsgbXV0YWJsZTogZmFsc2UsIGFkZEdyYW50c1RvUmVzb3VyY2VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vbi10ZW1wbGF0ZSBjb25maWcgZmlsZXMgZm9yIENvZGVQaXBlbGluZSBhY3Rpb25zXG4gICAqXG4gICAqIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIHRhZ3MuXG4gICAqL1xuICBwcml2YXRlIHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmIChPYmplY3Qua2V5cyhzdGFjay50YWdzKS5sZW5ndGggPT09IDApIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuXG4gICAgY29uc3QgYWJzQ29uZmlnUGF0aCA9IGAke3N0YWNrLmFic29sdXRlVGVtcGxhdGVQYXRofS5jb25maWcuanNvbmA7XG4gICAgY29uc3QgcmVsYXRpdmVDb25maWdQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBhYnNDb25maWdQYXRoKTtcblxuICAgIC8vIFdyaXRlIHRoZSB0ZW1wbGF0ZSBjb25maWd1cmF0aW9uIGZpbGUgKGZvciBwYXJhbWV0ZXJzIGludG8gQ3JlYXRlQ2hhbmdlU2V0IGNhbGwgdGhhdFxuICAgIC8vIGNhbm5vdCBiZSBjb25maWd1cmVkIGFueSBvdGhlciB3YXkpLiBUaGV5IG11c3QgY29tZSBmcm9tIGEgZmlsZSwgYW5kIHRoZXJlJ3MgdW5mb3J0dW5hdGVseVxuICAgIC8vIG5vIGJldHRlciBob29rIHRvIHdyaXRlIHRoaXMgZmlsZSAoYGNvbnN0cnVjdC5vblN5bnRoZXNpemUoKWAgd291bGQgaGF2ZSBiZWVuIHRoZSBwcmltZSBjYW5kaWRhdGVcbiAgICAvLyBidXQgdGhhdCBpcyBiZWluZyBkZXByZWNhdGVkLS1hbmQgRGVwbG95Q2RrU3RhY2tBY3Rpb24gaXNuJ3QgZXZlbiBhIGNvbnN0cnVjdCkuXG4gICAgd3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24oYWJzQ29uZmlnUGF0aCwge1xuICAgICAgVGFnczogbm9VbmRlZmluZWQoc3RhY2sudGFncyksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVsYXRpdmVDb25maWdQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgcm9sZSBpcyB1c2VkIGJ5IGJvdGggdGhlIENvZGVQaXBlbGluZSBidWlsZCBhY3Rpb24gYW5kIHJlbGF0ZWQgQ29kZUJ1aWxkIHByb2plY3QuIENvbnNvbGlkYXRpbmcgdGhlc2UgdHdvXG4gICAqIHJvbGVzIGludG8gb25lLCBhbmQgcmUtdXNpbmcgYWNyb3NzIGFsbCBhc3NldHMsIHNhdmVzIHNpZ25pZmljYW50IHNpemUgb2YgdGhlIGZpbmFsIHN5bnRoZXNpemVkIG91dHB1dC5cbiAgICogTW9kZWxlZCBhZnRlciB0aGUgQ29kZVBpcGVsaW5lIHJvbGUgYW5kICdDb2RlUGlwZWxpbmVBY3Rpb25Sb2xlJyByb2xlcy5cbiAgICogR2VuZXJhdGVzIG9uZSByb2xlIHBlciBhc3NldCB0eXBlIHRvIHNlcGFyYXRlIGZpbGUgYW5kIERvY2tlci9pbWFnZS1iYXNlZCBwZXJtaXNzaW9ucy5cbiAgICovXG4gIHByaXZhdGUgb2J0YWluQXNzZXRDb2RlQnVpbGRSb2xlKGFzc2V0VHlwZTogQXNzZXRUeXBlKTogaWFtLklSb2xlIHtcbiAgICBpZiAodGhpcy5hc3NldENvZGVCdWlsZFJvbGVzW2Fzc2V0VHlwZV0pIHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0Q29kZUJ1aWxkUm9sZXNbYXNzZXRUeXBlXTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHRoaXMpO1xuXG4gICAgY29uc3Qgcm9sZVByZWZpeCA9IGFzc2V0VHlwZSA9PT0gQXNzZXRUeXBlLkRPQ0tFUl9JTUFHRSA/ICdEb2NrZXInIDogJ0ZpbGUnO1xuICAgIGNvbnN0IGFzc2V0Um9sZSA9IG5ldyBBc3NldFNpbmdsZXRvblJvbGUodGhpcy5hc3NldHNTY29wZSwgYCR7cm9sZVByZWZpeH1Sb2xlYCwge1xuICAgICAgcm9sZU5hbWU6IFBoeXNpY2FsTmFtZS5HRU5FUkFURV9JRl9ORUVERUQsXG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uQ29tcG9zaXRlUHJpbmNpcGFsKFxuICAgICAgICBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2NvZGVidWlsZC5hbWF6b25hd3MuY29tJyksXG4gICAgICAgIG5ldyBpYW0uQWNjb3VudFByaW5jaXBhbChzdGFjay5hY2NvdW50KSxcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICAvLyBQdWJsaXNoaW5nIHJvbGUgYWNjZXNzXG4gICAgLy8gVGhlIEFSTnMgaW5jbHVkZSByYXcgQVdTIHBzZXVkbyBwYXJhbWV0ZXJzIChlLmcuLCAke0FXUzo6UGFydGl0aW9ufSksIHdoaWNoIG5lZWQgdG8gYmUgc3Vic3RpdHV0ZWQuXG4gICAgLy8gTGF6eS1ldmFsdWF0ZWQgc28gYWxsIGFzc2V0IHB1Ymxpc2hpbmcgcm9sZXMgYXJlIGluY2x1ZGVkLlxuICAgIGFzc2V0Um9sZS5hZGRUb1BvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ3N0czpBc3N1bWVSb2xlJ10sXG4gICAgICByZXNvdXJjZXM6IExhenkubGlzdCh7IHByb2R1Y2U6ICgpID0+IEFycmF5LmZyb20odGhpcy5hc3NldFB1Ymxpc2hpbmdSb2xlc1thc3NldFR5cGVdID8/IFtdKS5tYXAoYXJuID0+IEZuLnN1Yihhcm4pKSB9KSxcbiAgICB9KSk7XG5cbiAgICAvLyBHcmFudCBwdWxsIGFjY2VzcyBmb3IgYW55IEVDUiByZWdpc3RyaWVzIGFuZCBzZWNyZXRzIHRoYXQgZXhpc3RcbiAgICBpZiAoYXNzZXRUeXBlID09PSBBc3NldFR5cGUuRE9DS0VSX0lNQUdFKSB7XG4gICAgICB0aGlzLmRvY2tlckNyZWRlbnRpYWxzLmZvckVhY2gocmVnID0+IHJlZy5ncmFudFJlYWQoYXNzZXRSb2xlLCBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORykpO1xuICAgIH1cblxuICAgIHRoaXMuYXNzZXRDb2RlQnVpbGRSb2xlc1thc3NldFR5cGVdID0gYXNzZXRSb2xlO1xuICAgIHJldHVybiBhc3NldFJvbGU7XG4gIH1cbn1cblxuZnVuY3Rpb24gZG9ja2VyVXNhZ2VGcm9tQ29kZUJ1aWxkKGNidDogQ29kZUJ1aWxkUHJvamVjdFR5cGUpOiBEb2NrZXJDcmVkZW50aWFsVXNhZ2UgfCB1bmRlZmluZWQge1xuICBzd2l0Y2ggKGNidCkge1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuQVNTRVRTOiByZXR1cm4gRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkc7XG4gICAgY2FzZSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TRUxGX01VVEFURTogcmV0dXJuIERvY2tlckNyZWRlbnRpYWxVc2FnZS5TRUxGX1VQREFURTtcbiAgICBjYXNlIENvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIOiByZXR1cm4gRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNZTlRIO1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUDogcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuXG5lbnVtIENvZGVCdWlsZFByb2plY3RUeXBlIHtcbiAgU1lOVEggPSAnU1lOVEgnLFxuICBBU1NFVFMgPSAnQVNTRVRTJyxcbiAgU0VMRl9NVVRBVEUgPSAnU0VMRl9NVVRBVEUnLFxuICBTVEVQID0gJ1NURVAnLFxufVxuXG5mdW5jdGlvbiBhY3Rpb25OYW1lPEE+KG5vZGU6IEdyYXBoTm9kZTxBPiwgcGFyZW50OiBHcmFwaE5vZGU8QT4pIHtcbiAgY29uc3QgbmFtZXMgPSBub2RlLmFuY2VzdG9yUGF0aChwYXJlbnQpLm1hcChuID0+IG4uaWQpO1xuICByZXR1cm4gbmFtZXMubWFwKHNhbml0aXplTmFtZSkuam9pbignLicpLnN1YnN0cigwLCAxMDApOyAvLyBDYW5ub3QgZXhjZWVkIDEwMCBjaGFyc1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZU5hbWUoeDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHgucmVwbGFjZSgvW15BLVphLXowLTkuQFxcLV9dL2csICdfJyk7XG59XG5cbi8qKlxuICogVGFrZSBhIHNldCBvZiB0cmFuY2hlcyBhbmQgc3BsaXQgdGhlbSB1cCBpbnRvIGdyb3VwcyBzb1xuICogdGhhdCBubyBzZXQgb2YgdHJhbmNoZXMgaGFzIG1vcmUgdGhhbiBuIGl0ZW1zIHRvdGFsXG4gKi9cbmZ1bmN0aW9uIGNodW5rVHJhbmNoZXM8QT4objogbnVtYmVyLCB4c3M6IEFbXVtdKTogQVtdW11bXSB7XG4gIGNvbnN0IHJldDogQVtdW11bXSA9IFtdO1xuXG4gIHdoaWxlICh4c3MubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHRyYW5jaGVzOiBBW11bXSA9IFtdO1xuICAgIGxldCBjb3VudCA9IDA7XG5cbiAgICB3aGlsZSAoeHNzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHhzID0geHNzWzBdO1xuICAgICAgY29uc3Qgc3BhY2VSZW1haW5pbmcgPSBuIC0gY291bnQ7XG4gICAgICBpZiAoeHMubGVuZ3RoIDw9IHNwYWNlUmVtYWluaW5nKSB7XG4gICAgICAgIHRyYW5jaGVzLnB1c2goeHMpO1xuICAgICAgICBjb3VudCArPSB4cy5sZW5ndGg7XG4gICAgICAgIHhzcy5zaGlmdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJhbmNoZXMucHVzaCh4cy5zcGxpY2UoMCwgc3BhY2VSZW1haW5pbmcpKTtcbiAgICAgICAgY291bnQgPSBuO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXQucHVzaCh0cmFuY2hlcyk7XG4gIH1cblxuXG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIGlzQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSh4OiBhbnkpOiB4IGlzIElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgcmV0dXJuICEhKHggYXMgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkpLnByb2R1Y2VBY3Rpb247XG59XG4iXX0=